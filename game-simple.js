// Состояние игры
const gameState = {
    chapter: 0,
    clarity: 50,
    memory: 50,
    choices: []
};

// Упрощённые данные игры (ключевые моменты истории)
const chapters = [
    {
        title: "Преморбид",
        text: "В детском саду я сторонился других, я был замкнутым и боялся людей вокруг себя. В детстве меня воспитывали высокоморальным человеком, православным. Отец боялся, что я испачкаю его вещи, и запрещал их трогать, впоследствии это привело к мизофобии.\n\nВнутренние голоса говорили мне сброситься под поезд. Дома я бился головой об стену, чтобы избавиться от них.",
        choices: [
            { text: "Попытаться понять внутренние голоса", next: 1, clarity: -10, memory: 5 },
            { text: "Игнорировать их и сосредоточиться на учёбе", next: 2, clarity: 5, memory: 10 },
            { text: "Искать ответы в книгах и науке", next: 3, clarity: 5, memory: 15 }
        ]
    },
    {
        title: "Школа",
        text: "В школе ко мне относились с отвращением. Я учился в музыкальном классе с большим количеством девушек, им был важен внешний вид, а я был из небогатой семьи и плохо одет.\n\nИз-за негативного отношения к моему внешнему виду со стороны одноклассниц я очень ценил материальное — я не ходил по грязным местам, день ото дня оттирал все пятнышки на моих джинсах.",
        choices: [
            { text: "Продолжать учиться, игнорируя насмешки", next: 4, clarity: 10, memory: 15 },
            { text: "Попытаться найти друзей среди таких же отстранённых", next: 5, clarity: 5, memory: 10 },
            { text: "Углубиться в философию и размышления", next: 6, clarity: -5, memory: 20 }
        ]
    },
    {
        title: "Успехи",
        text: "В седьмом классе я занял место на школьной олимпиаде по математике, делал успехи по литературе, математике и физике и впервые получил пятёрку на экзамене по фортепиано. Но даже так я чувствовал себя где-то «в стороне».\n\nВ девятом классе я занял второе место на олимпиаде по физике в НИЯУ МИФИ.",
        choices: [
            { text: "Продолжать добиваться успехов в учёбе", next: 7, clarity: 15, memory: 20 },
            { text: "Начать искать смысл за пределами обычного", next: 8, clarity: -10, memory: 15 },
            { text: "Попытаться стать более социальным", next: 9, clarity: 10, memory: 5 }
        ]
    },
    {
        title: "Друг B",
        text: "В новой школе я познакомился с очень важным для меня человеком «B», мы с ним постоянно спорили, обсуждали естественные науки. Я не признавал проигрышей в спорах, оправдывался релятивизмом и уходил в софистику.\n\nДруг B косплеил персонажей из аниме, изучал квантовую физику, философствовал, он был аутичным. Для меня он казался гением. Он считал, что аксиом не существует.",
        choices: [
            { text: "Продолжать споры и поиск истины", next: 10, clarity: -5, memory: 20 },
            { text: "Начать сомневаться в своих убеждениях", next: 11, clarity: 10, memory: 15 },
            { text: "Принять его мировоззрение", next: 12, clarity: -10, memory: 25 }
        ]
    },
    {
        title: "Релятивизм",
        text: "Постоянные споры с другом B привели к тому, что я стал релятивистом. Всё относительно, всё неопределённо.\n\nЯ потерял опору, я был не определён и не видел в чём-либо объективного. Я не понимал, зачем учиться и работать, я считал, что это всего лишь средства контроля за людьми.",
        choices: [
            { text: "Углубиться в релятивизм", next: 13, clarity: -20, memory: 30 },
            { text: "Найти новые опоры", next: 14, clarity: 15, memory: 20 },
            { text: "Принять неопределённость", next: 15, clarity: 5, memory: 25 }
        ]
    },
    {
        title: "Друг C",
        text: "Я познакомился с другом «C». Он изучал сатанизм, и мы провели много времени в обсуждении его и многих других тем.\n\nОбщаясь с ним, я решил стать индивидуалистом. Со временем я понял, что мораль относительна и я могу без проблем ударить обидчика стулом.",
        choices: [
            { text: "Принять его философию", next: 16, clarity: -15, memory: 25 },
            { text: "Найти свой путь", next: 17, clarity: 10, memory: 20 },
            { text: "Балансировать между разными взглядами", next: 18, clarity: 5, memory: 15 }
        ]
    },
    {
        title: "Зависимость от мышления",
        text: "Я постоянно мыслил, и в конечном итоге, стал зависим от своего же мышления. Я хотел мыслить всё больше, точнее, глубже, законченнее и поэтому стал получать дискомфорт от неудовлетворённости в нём.\n\nЯ постоянно рефлексировал, дублировал мысли, детализировал. У меня была аддикция.",
        choices: [
            { text: "Попытаться остановить мышление", next: 19, clarity: 20, memory: 10 },
            { text: "Продолжать углубляться", next: 20, clarity: -30, memory: 35 },
            { text: "Найти другой способ существования", next: 21, clarity: 15, memory: 20 }
        ]
    },
    {
        title: "Университет",
        text: "В университете я был общительным, открытым, возможно, умным, пытался шокировать, изумлять своим поведением. У меня было много товарищей.\n\nВсё это было не потому, что я золотой ребёнок, как может показаться; всё это было продумано и спланировано. Это было частью эпатажа.",
        choices: [
            { text: "Продолжать играть роль", next: 22, clarity: -5, memory: 10 },
            { text: "Попытаться быть искренним", next: 23, clarity: 10, memory: 15 },
            { text: "Отстраниться от социальных игр", next: 24, clarity: 15, memory: 5 }
        ]
    },
    {
        title: "MDA",
        text: "Позже я принял MDA и у меня вскрылась латентная кататоническая шизофрения.\n\nВ состоянии опьянения делал кувырки по комнате. Воображал, что я бог. Потом начал проявлять сарказм по отношению к своим оппонентам. Мне казалось, что друзья сделали мне лоботомию.",
        choices: [
            { text: "Попытаться вернуться в реальность", next: 25, clarity: 15, memory: 20 },
            { text: "Углубиться в изменённое состояние", next: 26, clarity: -25, memory: 30 },
            { text: "Искать помощь", next: 27, clarity: 20, memory: 25 }
        ]
    },
    {
        title: "Первый психоз",
        text: "Когда я приехал домой, я соврал, сказав, что я немного выпил с друзьями. Некоторое время я ощущал интеллектуальный подъём. Дома я мечтал на следующий день встретить одну девушку из моей университетской группы, и на следующий день так и произошло.\n\nМне казалось, что я ускорен, а время замедлилось.",
        choices: [
            { text: "Попытаться понять, что происходит", next: 28, clarity: 10, memory: 15 },
            { text: "Принять изменённое восприятие", next: 29, clarity: -15, memory: 25 },
            { text: "Искать помощи у близких", next: 30, clarity: 25, memory: 30 }
        ]
    },
    {
        title: "Иллюзорный мир",
        text: "Я постоянно выводил что-то новое и при этом говорил себе этого не делать, был онанистом в мысли, резонёром, у меня была метафизическая интоксикация. Я искал во всём смысл, причину, основу.\n\nБез остановки мыслил логически, мыслил в крайность, был демагогом, занимался бесплодным мудрствованием.",
        choices: [
            { text: "Продолжать искать смысл", next: 31, clarity: -25, memory: 35 },
            { text: "Попытаться остановиться", next: 32, clarity: 20, memory: 15 },
            { text: "Принять отсутствие смысла", next: 33, clarity: 15, memory: 25 }
        ]
    },
    {
        title: "Бред",
        text: "Мне казалось, что цвета характеризуют предметы, что серый цвет — скрытность. Возможно мне казалось что человек — радуга — добро — фотон. Есть зло — флюид.\n\nМне казалось, что государством проводятся эксперименты над людьми употребляющих психоделики. Мне казалось, что в моих часах жучок, что на улице за мной следят.",
        choices: [
            { text: "Попытаться отделить реальное от бреда", next: 34, clarity: 25, memory: 30 },
            { text: "Принять новую реальность", next: 35, clarity: -30, memory: 40 },
            { text: "Искать медицинскую помощь", next: 36, clarity: 30, memory: 35 }
        ]
    },
    {
        title: "Ремиссия",
        text: "Сейчас я нахожусь в состоянии, близком к тому, что было до первого психоза. Правда, я пока что не могу долгое время находиться вне дома.\n\nС каждым днём мой интеллект падает, я стал намного более легкомысленным, кратковременная память также ухудшилась. Происходит регресс к более простым формам мышления и поведения.",
        choices: [
            { text: "Принять изменения", next: 37, clarity: 20, memory: 15 },
            { text: "Бороться с ухудшением", next: 38, clarity: -10, memory: 25 },
            { text: "Найти новый способ существования", next: 39, clarity: 25, memory: 30 }
        ]
    },
    {
        title: "Принятие",
        text: "Я принял свою жизнь такой, какой она есть. До шизофрении я был в тюрьме своего прошлого. Первый психоз всё стер и освободил от этого.\n\nЯ достиг гармонии, счастья, я практически не мыслю, не мыслю о прошлом и будущем, живу здесь и сейчас, меня всё устраивает.",
        choices: [
            { text: "Продолжать жить в настоящем", next: 40, clarity: 30, memory: 15 },
            { text: "Размышлять о пути", next: 41, clarity: -10, memory: 30 },
            { text: "Найти баланс", next: 42, clarity: 25, memory: 25 }
        ]
    },
    {
        title: "Эпилог",
        text: "Путешествие продолжается. Мир остаётся неопределённым. Сложным. Красивым.\n\nЯ ни о чём не мыслю, я мыслю процессами, у меня нет речи, похож ли я на человека, если я использую лишь интуицию? Где грань, осознавая которую ты захочешь жить?\n\nМожно ли жить без семьи, работы и того, что я считал лишь симулякром? Хотите ли вы достичь шуньяты, пустоты?",
        choices: []
    }
];

// Инициализация игры
function initGame() {
    updateGameScreen();
}

// Обновление экрана игры
function updateGameScreen() {
    const currentChapter = chapters[gameState.chapter];
    
    // Обновляем заголовок
    document.getElementById('chapter-title').textContent = currentChapter.title;
    
    // Обновляем текст
    const storyText = document.getElementById('story-text');
    storyText.textContent = currentChapter.text;
    
    // Удаляем старые классы состояний
    document.body.classList.remove('state-confused', 'state-memory', 'state-philosophy');
    
    // Добавляем класс состояния в зависимости от ясности
    if (gameState.clarity < 30) {
        document.body.classList.add('state-confused');
    } else if (gameState.memory > 70) {
        document.body.classList.add('state-memory');
    } else if (gameState.clarity > 70 && gameState.memory > 60) {
        document.body.classList.add('state-philosophy');
    }
    
    // Обновляем выборы
    const choicesContainer = document.getElementById('choices-container');
    choicesContainer.innerHTML = '';
    
    if (currentChapter.choices.length === 0) {
        // Конец игры
        const endButton = document.createElement('button');
        endButton.className = 'choice-button';
        endButton.textContent = 'Начать заново';
        endButton.onclick = () => {
            gameState.chapter = 0;
            gameState.clarity = 50;
            gameState.memory = 50;
            gameState.choices = [];
            updateGameScreen();
        };
        choicesContainer.appendChild(endButton);
    } else {
        currentChapter.choices.forEach((choice, index) => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            button.textContent = choice.text;
            button.onclick = () => makeChoice(choice);
            choicesContainer.appendChild(button);
        });
    }
    
    // Обновляем статистику
    updateStats();
}

// Выбор игрока
function makeChoice(choice) {
    gameState.choices.push({
        chapter: gameState.chapter,
        choice: choice.text
    });
    
    // Обновляем статистику
    gameState.clarity = Math.max(0, Math.min(100, gameState.clarity + choice.clarity));
    gameState.memory = Math.max(0, Math.min(100, gameState.memory + choice.memory));
    
    // Переходим к следующей главе
    if (choice.next < chapters.length) {
        gameState.chapter = choice.next;
    } else {
        // Если следующей главы нет, переходим к эпилогу
        gameState.chapter = chapters.length - 1;
    }
    
    updateGameScreen();
}

// Обновление статистики
function updateStats() {
    document.getElementById('clarity-value').textContent = gameState.clarity;
    document.getElementById('memory-value').textContent = gameState.memory;
    
    document.getElementById('clarity-bar').style.width = gameState.clarity + '%';
    document.getElementById('memory-bar').style.width = gameState.memory + '%';
}

// Запуск игры
window.onload = initGame;

