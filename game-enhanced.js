// Расширенное состояние игры
const gameState = {
    chapter: 0,
    clarity: 50,
    memory: 50,
    health: 50,
    philosophy: 50,
    sociality: 50,
    achievements: [],
    playTime: 0,
    choices: [],
    path: {
        scholar: 0,
        mystic: 0,
        realist: 0,
        extreme: 0,
        balanced: 0
    },
    stats: {
        totalChoices: 0,
        extremeChoices: 0,
        balancedChoices: 0,
        comboChoices: 0, // Последовательные одинаковые типы выборов
        lastChoiceType: null
    },
    ending: null, // Тип достигнутой концовки
    specialEvents: [], // События, которые произошли
    secrets: [], // Найденные секреты
    hints: 3 // Количество подсказок
};

// Система достижений
const achievements = {
    philosopher: { name: "Философ", desc: "Достиг 80+ в философии", unlocked: false },
    survivor: { name: "Выживший", desc: "Прошёл через психоз", unlocked: false },
    balanced: { name: "Баланс", desc: "Поддерживал баланс всех параметров", unlocked: false },
    extreme: { name: "Экстремист", desc: "Сделал 10 экстремальных выборов", unlocked: false },
    scholar: { name: "Учёный", desc: "Выбрал путь науки", unlocked: false },
    mystic: { name: "Мистик", desc: "Выбрал путь мистики", unlocked: false },
    realist: { name: "Реалист", desc: "Выбрал путь реальности", unlocked: false },
    explorer: { name: "Исследователь", desc: "Нашёл 5 секретных путей", unlocked: false },
    combo: { name: "Комбинатор", desc: "Сделал 3 комбо-выбора подряд", unlocked: false },
    perfect: { name: "Идеал", desc: "Все параметры в диапазоне 45-55", unlocked: false },
    comeback: { name: "Возвращение", desc: "Восстановился с здоровья <20 до >60", unlocked: false },
    master: { name: "Мастер", desc: "Получил все 6 концовок", unlocked: false },
    secret: { name: "Секретный", desc: "Нашёл скрытую главу", unlocked: false }
};

// Расширенные главы игры с реальными цитатами из текста
const chapters = [
    {
        title: "Преморбид",
        text: "В детском саду я сторонился других, я был замкнутым и боялся людей вокруг себя. В детстве меня воспитывали высокоморальным человеком, православным. Отец боялся, что я испачкаю его вещи, и запрещал их трогать, впоследствии это привело к мизофобии.\n\nВнутренние голоса говорили мне сброситься под поезд. Дома я бился головой об стену, чтобы избавиться от них. А в Сочи я изучал магию по книге и тренировался копить тепло в моих руках.",
        choices: [
            { 
                text: "Попытаться понять внутренние голоса", 
                next: 1, 
                clarity: -10, memory: 5, health: -5, philosophy: 10, sociality: -5,
                extreme: true
            },
            { 
                text: "Игнорировать их и сосредоточиться на учёбе", 
                next: 2, 
                clarity: 5, memory: 10, health: 0, philosophy: 0, sociality: 0,
                achievement: "scholar"
            },
            { 
                text: "Искать ответы в книгах и науке", 
                next: 3, 
                clarity: 5, memory: 15, health: 5, philosophy: 10, sociality: -5
            },
            {
                text: "Изучать магию и паранормальное",
                next: 4,
                clarity: -5, memory: 10, health: -5, philosophy: 15, sociality: -10,
                achievement: "mystic"
            }
        ]
    },
    {
        title: "Голоса",
        text: "Голоса становятся настойчивее. Они шепчут о вещах, которые ты не можешь понять. Мир вокруг кажется неопределённым. Ты чувствуешь себя отстранённым от других детей.\n\nВ школе ко мне относились с отвращением. Я учился в музыкальном классе с большим количеством девушек, им был важен внешний вид, а я был из небогатой семьи и плохо одет. Я ругался с бабушкой по поводу той одежды, в которую она меня одевала перед тем, как мне пойти в школу.",
        choices: [
            { 
                text: "Продолжать учиться, игнорируя насмешки", 
                next: 5, 
                clarity: 10, memory: 15, health: 5, philosophy: 0, sociality: -5
            },
            { 
                text: "Попытаться найти друзей среди таких же отстранённых", 
                next: 6, 
                clarity: 5, memory: 10, health: 5, philosophy: 5, sociality: 10
            },
            { 
                text: "Углубиться в философию и размышления", 
                next: 7, 
                clarity: -5, memory: 20, health: -5, philosophy: 20, sociality: -10,
                extreme: true
            },
            {
                text: "Играть роль шута, чтобы приспособиться",
                next: 8,
                clarity: 0, memory: 5, health: -5, philosophy: -10, sociality: 15
            }
        ]
    },
    {
        title: "ОКР и Компульсии",
        text: "Бог мне казался очень строгим. Я боялся Господа, и из-за моей православной веры и страха возникла компульсивность. Я по три раза мыл руки, выключал и включал свет.\n\nЯ был очень чувствителен, любопытен, морален и скромен. В моей семье были строгие правила. Я спрашивал, можно ли мне сходить в туалет или поесть. Из-за негативного отношения к моему внешнему виду я очень ценил материальное — день ото дня оттирал все пятнышки на моих джинсах.",
        choices: [
            {
                text: "Следовать компульсиям, чтобы уменьшить тревогу",
                next: 9,
                clarity: -10, memory: -5, health: -10, philosophy: -5, sociality: -10,
                extreme: true
            },
            {
                text: "Попытаться преодолеть компульсии силой воли",
                next: 10,
                clarity: 15, memory: 10, health: 10, philosophy: 5, sociality: 5
            },
            {
                text: "Рационализировать свои действия",
                next: 11,
                clarity: 5, memory: 15, health: 0, philosophy: 15, sociality: 0
            },
            {
                text: "Обратиться за помощью",
                next: 12,
                clarity: 10, memory: 5, health: 15, philosophy: -5, sociality: 10
            }
        ]
    },
    {
        title: "Учёба и Наука",
        text: "В седьмом классе я занял место на школьной олимпиаде по математике, делал успехи по литературе, математике и физике и впервые получил пятёрку на экзамене по фортепиано. Но даже так я чувствовал себя где-то «в стороне».\n\nВ девятом классе я занял второе место на олимпиаде по физике в НИЯУ МИФИ. Я постоянно рефлексировал насчёт правильности своего поведения, обдумывал каждый свой поступок и анализировал общество.",
        choices: [
            {
                text: "Продолжать добиваться успехов в учёбе",
                next: 13,
                clarity: 15, memory: 20, health: 5, philosophy: 5, sociality: -5,
                achievement: "scholar"
            },
            {
                text: "Начать искать смысл за пределами обычного",
                next: 14,
                clarity: -10, memory: 15, health: -5, philosophy: 25, sociality: -10,
                extreme: true
            },
            {
                text: "Попытаться стать более социальным",
                next: 15,
                clarity: 10, memory: 5, health: 10, philosophy: -10, sociality: 20
            },
            {
                text: "Балансировать учёбу и личную жизнь",
                next: 16,
                clarity: 10, memory: 15, health: 10, philosophy: 5, sociality: 10,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Друг B",
        text: "В новой школе я познакомился с очень важным для меня человеком «B», мы с ним постоянно спорили, обсуждали естественные науки. Я не признавал проигрышей в спорах, оправдывался релятивизмом и уходил в софистику.\n\nДруг B косплеил персонажей из аниме, изучал квантовую физику, философствовал, он был аутичным. Для меня он казался гением. Он считал, что аксиом не существует. Хотел жить вечно. Также он сделал себе тульпу, у него была очень развитая логика.",
        choices: [
            {
                text: "Продолжать споры и поиск истины",
                next: 17,
                clarity: -5, memory: 20, health: -5, philosophy: 20, sociality: 5
            },
            {
                text: "Начать сомневаться в своих убеждениях",
                next: 18,
                clarity: 10, memory: 15, health: 5, philosophy: 10, sociality: 0
            },
            {
                text: "Принять его мировоззрение полностью",
                next: 19,
                clarity: -10, memory: 25, health: -10, philosophy: 30, sociality: -10,
                extreme: true
            },
            {
                text: "Найти баланс между разными взглядами",
                next: 20,
                clarity: 5, memory: 15, health: 5, philosophy: 15, sociality: 10
            }
        ]
    },
    {
        title: "Релятивизм",
        text: "Постоянные споры с другом B привели к тому, что я стал релятивистом. Всё относительно, всё неопределённо.\n\nЯ потерял опору, я был не определён и не видел в чём-либо объективного. Я не понимал, зачем учиться и работать, я считал, что это всего лишь средства контроля за людьми. Из-за релятивизма, и постоянной смены убеждений я потерял опору, я был не определён и не видел в чём-либо объективного.",
        choices: [
            {
                text: "Углубиться в релятивизм",
                next: 21,
                clarity: -20, memory: 30, health: -15, philosophy: 30, sociality: -15,
                extreme: true
            },
            {
                text: "Найти новые опоры",
                next: 22,
                clarity: 15, memory: 20, health: 10, philosophy: 10, sociality: 10
            },
            {
                text: "Принять неопределённость как данность",
                next: 23,
                clarity: 5, memory: 25, health: 5, philosophy: 20, sociality: 0
            },
            {
                text: "Вернуться к более простым истинам",
                next: 24,
                clarity: 20, memory: 15, health: 15, philosophy: -10, sociality: 10,
                achievement: "realist"
            }
        ]
    },
    {
        title: "Друг C",
        text: "Я познакомился с другом «C». Он изучал сатанизм, и мы провели много времени в обсуждении его и многих других тем.\n\nОбщаясь с ним, я решил стать индивидуалистом. Со временем я понял, что мораль относительна и я могу без проблем ударить обидчика стулом. Друг C продумывал сценарии убийства и был иногда экспрессивен. Я стал очень циничным. Я ни на кого не надеялся, кроме самого себя.",
        choices: [
            {
                text: "Принять его философию",
                next: 25,
                clarity: -15, memory: 25, health: -20, philosophy: 20, sociality: -20,
                extreme: true
            },
            {
                text: "Найти свой путь",
                next: 26,
                clarity: 10, memory: 20, health: 5, philosophy: 15, sociality: 5
            },
            {
                text: "Балансировать между разными взглядами",
                next: 27,
                clarity: 5, memory: 15, health: 5, philosophy: 10, sociality: 10
            },
            {
                text: "Отвергнуть крайности",
                next: 28,
                clarity: 20, memory: 10, health: 15, philosophy: -5, sociality: 15
            }
        ]
    },
    {
        title: "Зависимость от мышления",
        text: "Я постоянно мыслил, и в конечном итоге, стал зависим от своего же мышления. Я хотел мыслить всё больше, точнее, глубже, законченнее и поэтому стал получать дискомфорт от неудовлетворённости в нём.\n\nЯ постоянно рефлексировал, дублировал мысли, детализировал. У меня была аддикция. Я стал перфекционистом в душе и минималистом в материи. Я постоянно сомневался во всём. Я был поглощён деталями.\n\nПри постоянном мышлении время течёт очень быстро. Я постоянно навязчиво читал энциклопедии, копировал статьи в заметки и записывал свои идеи.",
        choices: [
            {
                text: "Попытаться остановить мышление",
                next: 33,
                clarity: 20, memory: 10, health: 15, philosophy: -10, sociality: 5
            },
            {
                text: "Продолжать углубляться",
                next: 34,
                clarity: -30, memory: 35, health: -25, philosophy: 35, sociality: -20,
                extreme: true
            },
            {
                text: "Найти другой способ существования",
                next: 35,
                clarity: 15, memory: 20, health: 10, philosophy: 10, sociality: 15
            },
            {
                text: "Принять мышление как часть себя",
                next: 36,
                clarity: -5, memory: 25, health: -5, philosophy: 25, sociality: -5
            },
            {
                text: "Чередовать психическую и физическую нагрузку",
                next: 37,
                clarity: 18, memory: 15, health: 20, philosophy: 5, sociality: 10,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Университет",
        text: "В университете я был общительным, открытым, возможно, умным, пытался шокировать, изумлять своим поведением. У меня было много товарищей.\n\nВсё это было не потому, что я золотой ребёнок, как может показаться; всё это было продумано и спланировано. Это было частью эпатажа, я хотел вызвать как можно больше удивления и наладить отношения с другими людьми.",
        choices: [
            {
                text: "Продолжать играть роль",
                next: 33,
                clarity: -5, memory: 10, health: -5, philosophy: -5, sociality: 15
            },
            {
                text: "Попытаться быть искренним",
                next: 34,
                clarity: 10, memory: 15, health: 10, philosophy: 5, sociality: 20
            },
            {
                text: "Отстраниться от социальных игр",
                next: 35,
                clarity: 15, memory: 5, health: 5, philosophy: 15, sociality: -10
            },
            {
                text: "Найти баланс между ролью и искренностью",
                next: 36,
                clarity: 10, memory: 12, health: 8, philosophy: 8, sociality: 15
            }
        ]
    },
    {
        title: "MDA",
        text: "Позже я принял MDA и у меня вскрылась латентная кататоническая шизофрения.\n\nВ состоянии опьянения делал кувырки по комнате. Воображал, что я бог, лёг на пол и мне казалось, что я излучаю энергию. Потом начал проявлять сарказм по отношению к своим оппонентам. Позже вместо подруги я увидел «демона» с жирным телом. Мне показалось, что моего друга заменили, что он за стеной, где-то глубоко запрятанный.",
        choices: [
            {
                text: "Попытаться вернуться в реальность",
                next: 37,
                clarity: 15, memory: 20, health: 10, philosophy: -5, sociality: 10
            },
            {
                text: "Углубиться в изменённое состояние",
                next: 38,
                clarity: -25, memory: 30, health: -30, philosophy: 30, sociality: -25,
                extreme: true
            },
            {
                text: "Искать помощь у близких",
                next: 39,
                clarity: 20, memory: 25, health: 25, philosophy: -10, sociality: 20
            },
            {
                text: "Принять новую реальность",
                next: 40,
                clarity: -30, memory: 35, health: -35, philosophy: 40, sociality: -30,
                extreme: true, achievement: "mystic"
            }
        ]
    },
    {
        title: "Первый психоз",
        text: "Когда я приехал домой, я соврал, сказав, что я немного выпил с друзьями. Мне казалось, что я ускорен, а время замедлилось.\n\nМне казалось, что друзья сделали мне лоботомию при приёме MDA, и что в моём горле нарост. Мне казалось, что я научился чувствовать свой мозг, что я стал богом и могу управлять погодой, мне казалось, что я возымел мистическое зрение, что я вампир-рептилоид.",
        choices: [
            {
                text: "Попытаться понять, что происходит",
                next: 41,
                clarity: 10, memory: 15, health: 5, philosophy: 10, sociality: 5
            },
            {
                text: "Принять изменённое восприятие",
                next: 42,
                clarity: -15, memory: 25, health: -20, philosophy: 25, sociality: -15,
                extreme: true
            },
            {
                text: "Искать помощи у близких",
                next: 43,
                clarity: 25, memory: 30, health: 30, philosophy: -10, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Попытаться контролировать состояние",
                next: 44,
                clarity: 5, memory: 20, health: 10, philosophy: 15, sociality: 0
            }
        ]
    },
    {
        title: "Иллюзорный мир",
        text: "Я постоянно выводил что-то новое и при этом говорил себе этого не делать, был онанистом в мысли, резонёром, у меня была метафизическая интоксикация. Я искал во всём смысл, причину, основу.\n\nБез остановки мыслил логически, мыслил в крайность, был демагогом, занимался бесплодным мудрствованием, графоманией. Я хотел вывести, что-либо новое, ощутить вкус победы.",
        choices: [
            {
                text: "Продолжать искать смысл",
                next: 45,
                clarity: -25, memory: 35, health: -20, philosophy: 35, sociality: -20,
                extreme: true
            },
            {
                text: "Попытаться остановиться",
                next: 46,
                clarity: 20, memory: 15, health: 15, philosophy: -10, sociality: 10
            },
            {
                text: "Принять отсутствие смысла",
                next: 47,
                clarity: 15, memory: 25, health: 10, philosophy: 20, sociality: 5
            },
            {
                text: "Найти простой смысл в существовании",
                next: 48,
                clarity: 25, memory: 20, health: 20, philosophy: -5, sociality: 15,
                achievement: "realist"
            }
        ]
    },
    {
        title: "Бред и Паранойя",
        text: "Мне казалось, что цвета характеризуют предметы, что серый цвет — скрытность. Возможно мне казалось что человек — радуга — добро — фотон. Есть зло — флюид.\n\nМне казалось, что государством проводятся эксперименты над людьми употребляющих психоделики. Мне казалось, что в моих часах жучок, что на улице за мной следят правоохранительные органы. Мои друзья шептались на паре и мне казалось, что они планируют моё убийство.",
        choices: [
            {
                text: "Попытаться отделить реальное от бреда",
                next: 49,
                clarity: 25, memory: 30, health: 20, philosophy: -5, sociality: 15,
                achievement: "realist"
            },
            {
                text: "Принять новую реальность",
                next: 50,
                clarity: -30, memory: 40, health: -35, philosophy: 40, sociality: -30,
                extreme: true
            },
            {
                text: "Искать медицинскую помощь",
                next: 51,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Попытаться жить с бредом",
                next: 52,
                clarity: -10, memory: 20, health: -10, philosophy: 20, sociality: -10
            }
        ]
    },
    {
        title: "Кубики Рубика",
        text: "Я купил дюжину кубиков Рубика, я кручу их в руках, кручу случайно, полным перебором. Мне казалось, что кубики Рубика магические, проклинают, высасывают кровь, зашумливают дом, увеличивают контроль, создают барьеры.\n\nОни контейнеры информации, и, крутя их, мы можем получать знания. Мне казалось, что быстро собирая кубик Рубика, я могу ускорять себя и замедлять течение времени. Один раз, занимаясь этим, я настолько ускорил себя, что когда я открыл кран, текущая вода из него замерла.",
        choices: [
            {
                text: "Продолжать использовать кубики как магический инструмент",
                next: 53,
                clarity: -20, memory: 25, health: -15, philosophy: 30, sociality: -20,
                extreme: true
            },
            {
                text: "Использовать их как обычную головоломку",
                next: 54,
                clarity: 15, memory: 20, health: 15, philosophy: -10, sociality: 10,
                achievement: "realist"
            },
            {
                text: "Отказаться от кубиков",
                next: 55,
                clarity: 20, memory: 10, health: 20, philosophy: -15, sociality: 15
            },
            {
                text: "Найти баланс между магией и реальностью",
                next: 56,
                clarity: 10, memory: 18, health: 10, philosophy: 15, sociality: 5
            }
        ]
    },
    {
        title: "Ремиссия",
        text: "Сейчас я нахожусь в состоянии, близком к тому, что было до первого психоза. Правда, я пока что не могу долгое время находиться вне дома.\n\nС каждым днём мой интеллект падает, я стал намного более легкомысленным, кратковременная память также ухудшилась. Происходит регресс к более простым формам мышления и поведения. Происходит распад.",
        choices: [
            {
                text: "Принять изменения",
                next: 64, // Ведёт к принятию
                clarity: 20, memory: 15, health: 15, philosophy: 10, sociality: 10,
                achievement: "survivor"
            },
            {
                text: "Бороться с ухудшением",
                next: 84, // Может привести к плохому финалу
                clarity: -10, memory: 25, health: -15, philosophy: 20, sociality: 5,
                extreme: true
            },
            {
                text: "Найти новый способ существования",
                next: 64, // Ведёт к принятию
                clarity: 25, memory: 30, health: 20, philosophy: 15, sociality: 20,
                achievement: "balanced"
            },
            {
                text: "Смириться и жить здесь и сейчас",
                next: 64, // Ведёт к принятию
                clarity: 30, memory: 20, health: 25, philosophy: -5, sociality: 15
            }
        ]
    },
    {
        title: "Принятие",
        text: "Я принял свою жизнь такой, какой она есть. До шизофрении я был в тюрьме своего прошлого. Первый психоз всё стер и освободил от этого.\n\nЯ достиг гармонии, счастья, я практически не мыслю, не мыслю о прошлом и будущем, живу здесь и сейчас, меня всё устраивает. Я практически не мыслю, не мыслю о прошлом и будущем, живу здесь и сейчас, меня всё устраивает, мыслю образно, практически без речевых звуков.",
        choices: [
            {
                text: "Продолжать жить в настоящем",
                next: 65, // Ведёт к финалу
                clarity: 30, memory: 15, health: 20, philosophy: 5, sociality: 15
            },
            {
                text: "Размышлять о пути",
                next: 65, // Ведёт к финалу
                clarity: -10, memory: 30, health: -10, philosophy: 25, sociality: 0,
                achievement: "philosopher"
            },
            {
                text: "Найти баланс между прошлым и настоящим",
                next: 65, // Ведёт к финалу
                clarity: 25, memory: 25, health: 18, philosophy: 15, sociality: 18,
                achievement: "balanced"
            },
            {
                text: "Помогать другим с похожими проблемами",
                next: 65, // Ведёт к финалу
                clarity: 20, memory: 20, health: 20, philosophy: 10, sociality: 25
            }
        ]
    },
    {
        title: "Второй психоз",
        text: "Мне казалось, что я телепатически соединён со многими людьми, они виртуально вкалывают в меня разнообразные наркотические вещества, и я переживаю слабый воображаемый trip.\n\nМне казалось, что разговариваю с так называемыми «судьями», которые в каком-то смысле являются ангелами. Мне казалось, что каждый человек представляет из себя мировую идею, слово и волну. Что человек после смерти превращается либо во флюид, если он зло, либо в фотон, если он добро.",
        choices: [
            {
                text: "Попытаться вернуться в реальность",
                next: 66,
                clarity: 20, memory: 25, health: 15, philosophy: -10, sociality: 15
            },
            {
                text: "Углубиться в мистическое состояние",
                next: 67,
                clarity: -20, memory: 30, health: -25, philosophy: 35, sociality: -20,
                extreme: true
            },
            {
                text: "Искать медицинскую помощь",
                next: 68,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 30,
                achievement: "survivor"
            },
            {
                text: "Принять новую реальность полностью",
                next: 69,
                clarity: -30, memory: 40, health: -40, philosophy: 45, sociality: -35,
                extreme: true
            }
        ]
    },
    {
        title: "Третий психоз",
        text: "Сложно глотать. Снова кажется, что будет плохо, если далеко окажусь от дома или же буду заниматься какой-либо деятельностью сравнительно недолгое время.\n\nПока гуляю, примечаю многие вещи и проецирую их в своё состояние. Кажется, что обстановка на улице становится с каждой минутой всё экстремальнее. Что либо я на кого-либо наброшусь или кто-то на меня. Постоянные фантомные боли в глазах и непреодолимое желание их вырвать.",
        choices: [
            {
                text: "Максимально ограничить мышление и деятельность",
                next: 70,
                clarity: 15, memory: 10, health: 20, philosophy: -15, sociality: -10
            },
            {
                text: "Обратиться к православию за помощью",
                next: 71,
                clarity: 10, memory: 15, health: 15, philosophy: -20, sociality: 10
            },
            {
                text: "Продолжать бороться самостоятельно",
                next: 72,
                clarity: -15, memory: 20, health: -20, philosophy: 25, sociality: -15,
                extreme: true
            },
            {
                text: "Искать профессиональную помощь",
                next: 73,
                clarity: 25, memory: 30, health: 30, philosophy: -15, sociality: 25,
                achievement: "survivor"
            }
        ]
    },
    {
        title: "Изнанка",
        text: "Раньше я мыслил как хотел, имел максимальную свободу в мышлении, сейчас я фильтрую большинство мыслей. Раньше я страдал, сейчас я достиг счастья.\n\nЯ отменяю неугодные мне мысли словами «не знаю» или «бог с ним». Я фильтрую мысли кажущиеся ошибочными, неправильными, фильтрую мысли выводящие из баланса, равновесия, нарушающие гармонию.",
        choices: [
            {
                text: "Продолжать фильтровать мысли",
                next: 74,
                clarity: 20, memory: 15, health: 25, philosophy: -10, sociality: 10
            },
            {
                text: "Найти баланс между фильтрацией и свободой",
                next: 75,
                clarity: 15, memory: 20, health: 20, philosophy: 10, sociality: 15,
                achievement: "balanced"
            },
            {
                text: "Вернуться к свободному мышлению",
                next: 76,
                clarity: -20, memory: 30, health: -25, philosophy: 30, sociality: -20,
                extreme: true
            },
            {
                text: "Принять умеренность во всём",
                next: 77,
                clarity: 25, memory: 25, health: 25, philosophy: 15, sociality: 20,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Фильтрация мыслей",
        text: "Я фильтрую большинство мыслей. Фильтрация мыслей позволяет мне не испытывать ментальных страданий. Всё это проистекло из желания не иметь страданий и не «бесить» окружающий мир, быть в гармонии с ним.\n\nДа я живу в тюрьме, но я свободен. Если пытаться оправдывать ложь — можно зациклиться, ведь оправдать ложь невозможно.",
        choices: [
            {
                text: "Продолжать строгую фильтрацию",
                next: 78,
                clarity: 15, memory: 10, health: 20, philosophy: -15, sociality: 5
            },
            {
                text: "Найти золотую середину",
                next: 79,
                clarity: 20, memory: 20, health: 22, philosophy: 12, sociality: 18,
                achievement: "balanced"
            },
            {
                text: "Ослабить фильтрацию",
                next: 80,
                clarity: -10, memory: 25, health: -15, philosophy: 25, sociality: -10
            },
            {
                text: "Стремиться к умеренной свободе",
                next: 81,
                clarity: 18, memory: 18, health: 18, philosophy: 18, sociality: 18,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Баланс",
        text: "Я стремлюсь к середине между моим мировоззрением и его противоположностью. Выходить из системы, квантовать эту позицию и переходить к середине меж ними. Деконструировать, а потом конструировать.\n\nБыть между равностью и неравностью. Между осцилляцией, релятивизмом и определённостью и догмами. Стремлюсь не впадать в крайности, к умеренной психической нагрузке.",
        choices: [
            {
                text: "Продолжать искать баланс",
                next: 82,
                clarity: 20, memory: 20, health: 20, philosophy: 15, sociality: 20,
                achievement: "balanced"
            },
            {
                text: "Принять баланс как постоянное состояние",
                next: 83,
                clarity: 25, memory: 25, health: 25, philosophy: 18, sociality: 22,
                achievement: "balanced"
            },
            {
                text: "Вернуться к крайностям",
                next: 84,
                clarity: -15, memory: 25, health: -20, philosophy: 30, sociality: -15,
                extreme: true
            },
            {
                text: "Найти свой уникальный путь",
                next: 85,
                clarity: 22, memory: 22, health: 22, philosophy: 20, sociality: 20
            }
        ]
    },
    {
        title: "Детство: Материальное",
        text: "Из-за негативного отношения к моему внешнему виду со стороны одноклассниц я очень ценил материальное — я не ходил по грязным местам, день ото дня оттирал все пятнышки на моих джинсах. Я очень чутко относился к своему личному пространству.\n\nЗапрещал кому-либо входить на мою территорию и трогать мои вещи. Моя мать воспитывала меня противоположно воспитанию дедушкой и бабушкой, это породило двойные установки.",
        choices: [
            {
                text: "Защищать своё пространство",
                next: 86,
                clarity: 5, memory: 5, health: -5, philosophy: 0, sociality: -10
            },
            {
                text: "Стать менее привязанным к вещам",
                next: 87,
                clarity: 10, memory: 5, health: 10, philosophy: 5, sociality: 10
            },
            {
                text: "Найти баланс между защитой и открытостью",
                next: 88,
                clarity: 8, memory: 8, health: 8, philosophy: 5, sociality: 8,
                achievement: "balanced"
            },
            {
                text: "Сосредоточиться на внутреннем мире",
                next: 89,
                clarity: 15, memory: 10, health: 5, philosophy: 10, sociality: -5
            }
        ]
    },
    {
        title: "Детство: Изобретения",
        text: "В детстве я воображал вечные двигатели, машину на воздушной подушке, устройства передачи электричества на расстоянии. Я разбирал игрушки, изучая их устройство. Читал в запой энциклопедии.\n\nМне казалось, что я не имею того, что имеют другие дети. Приносил свои изобретения в школу. Помогал с настройкой мобильных телефонов.",
        choices: [
            {
                text: "Продолжать изобретать",
                next: 90,
                clarity: 5, memory: 20, health: -5, philosophy: 15, sociality: -10,
                achievement: "scholar"
            },
            {
                text: "Помогать другим с техникой",
                next: 91,
                clarity: 10, memory: 15, health: 5, philosophy: 5, sociality: 15
            },
            {
                text: "Найти баланс между изобретениями и общением",
                next: 92,
                clarity: 10, memory: 18, health: 5, philosophy: 10, sociality: 10
            },
            {
                text: "Сосредоточиться только на учёбе",
                next: 93,
                clarity: 15, memory: 25, health: 5, philosophy: 5, sociality: -15
            }
        ]
    },
    {
        title: "Олимпиада",
        text: "В седьмом классе я занял место на школьной олимпиаде по математике, делал успехи по литературе, математике и физике и впервые получил пятёрку на экзамене по фортепиано.\n\nНо даже так я чувствовал себя где-то «в стороне». В девятом классе я занял второе место на олимпиаде по физике в НИЯУ МИФИ.",
        choices: [
            {
                text: "Гордиться достижениями",
                next: 94,
                clarity: 15, memory: 20, health: 10, philosophy: 5, sociality: -5
            },
            {
                text: "Продолжать развиваться",
                next: 95,
                clarity: 10, memory: 25, health: 5, philosophy: 15, sociality: -10,
                achievement: "scholar"
            },
            {
                text: "Использовать успехи для улучшения отношений",
                next: 96,
                clarity: 5, memory: 15, health: 10, philosophy: 0, sociality: 20
            },
            {
                text: "Найти баланс между достижениями и общением",
                next: 97,
                clarity: 12, memory: 20, health: 10, philosophy: 8, sociality: 10,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Новая школа: Физмат",
        text: "Позже мне пришлось перевестись в другое общеобразовательное учреждение, в физмат, я планировал хорошо там учиться и получить хорошую репутацию. Я встретился на собрании с моими будущими одноклассниками.\n\nС одним из них — одноклассником «A» и с девушкой я пошёл гулять. Позже я давал ему советы по общению с девушками, он интересовался физикой.",
        choices: [
            {
                text: "Сосредоточиться на учёбе",
                next: 98,
                clarity: 10, memory: 20, health: 5, philosophy: 5, sociality: -10,
                achievement: "scholar"
            },
            {
                text: "Наладить отношения с новыми одноклассниками",
                next: 99,
                clarity: 5, memory: 10, health: 5, philosophy: -5, sociality: 20
            },
            {
                text: "Помогать другим и заводить друзей",
                next: 100,
                clarity: 8, memory: 15, health: 8, philosophy: 0, sociality: 15
            },
            {
                text: "Найти баланс между учёбой и общением",
                next: 101,
                clarity: 10, memory: 15, health: 8, philosophy: 5, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Лень и Оправдания",
        text: "Я много не понимал в программе новой школы, ленился, прогуливал, симулировал болезнь; там меня прозвали «призраком». Также я много врал своим друзьям.\n\nЯ ленился и оправдывал это тем, что не учу без понимания, а вывожу всё сам, саморазвиваюсь. С общепринятой точки зрения, я неправильно ставил приоритеты.",
        choices: [
            {
                text: "Продолжать лениться",
                next: 102,
                clarity: -5, memory: -10, health: -5, philosophy: 10, sociality: -10
            },
            {
                text: "Начать учиться серьёзно",
                next: 103,
                clarity: 15, memory: 25, health: 10, philosophy: 5, sociality: 5,
                achievement: "scholar"
            },
            {
                text: "Найти способ учиться через понимание",
                next: 104,
                clarity: 12, memory: 20, health: 8, philosophy: 15, sociality: 5
            },
            {
                text: "Балансировать между пониманием и изучением",
                next: 105,
                clarity: 10, memory: 18, health: 10, philosophy: 12, sociality: 8,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Друг B: Косплей и Тульта",
        text: "Друг B косплеил персонажей из аниме, имел необычную походку, копировал Лелуша и Джека Воробья, изучал квантовую физику, философствовал, он был аутичным.\n\nТакже он сделал себе тульпу, у него была очень развитая логика, для меня он казался гением. Он считал что аксиом не существует. Хотел жить вечно.",
        choices: [
            {
                text: "Попробовать создать свою тульпу",
                next: 106,
                clarity: -15, memory: 20, health: -15, philosophy: 25, sociality: -20,
                extreme: true
            },
            {
                text: "Продолжать обсуждать философию",
                next: 107,
                clarity: -5, memory: 20, health: -5, philosophy: 25, sociality: 5
            },
            {
                text: "Изучать квантовую физику вместе",
                next: 108,
                clarity: 5, memory: 25, health: 5, philosophy: 15, sociality: 5,
                achievement: "scholar"
            },
            {
                text: "Найти баланс между фантазией и реальностью",
                next: 109,
                clarity: 10, memory: 18, health: 8, philosophy: 15, sociality: 10
            }
        ]
    },
    {
        title: "Друг B: Игра про хакеров",
        text: "В девятом классе мы с ним хотели создать браузерную игру про хакеров, но идея была его. Так же он иногда превращался в свою сестру Моку и разговаривал со мной.\n\nПостоянные споры с ним привели к тому, что в будущем я стал релятивистом.",
        choices: [
            {
                text: "Работать над игрой вместе",
                next: 110,
                clarity: 10, memory: 20, health: 5, philosophy: 10, sociality: 10,
                achievement: "scholar"
            },
            {
                text: "Продолжать спорить о философии",
                next: 111,
                clarity: -10, memory: 25, health: -10, philosophy: 30, sociality: -10,
                extreme: true
            },
            {
                text: "Сосредоточиться на программировании",
                next: 112,
                clarity: 15, memory: 25, health: 10, philosophy: 5, sociality: 5
            },
            {
                text: "Найти баланс между проектом и отношениями",
                next: 113,
                clarity: 12, memory: 22, health: 10, philosophy: 12, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Издевательства: Груши",
        text: "Со временем я растерял всех своих друзей и в следующем году к нам перевелись ученики из другого класса. Меня начали жёстко стебать, мне приснилось, что из моего портфеля на парту вываливаются кусочки груш, на следующий день мои одноклассники, засунули груши в мой портфель и потоптались на нём.",
        choices: [
            {
                text: "Отомстить обидчикам",
                next: 114,
                clarity: -10, memory: 5, health: -15, philosophy: -10, sociality: -20,
                extreme: true
            },
            {
                text: "Игнорировать издевательства",
                next: 115,
                clarity: 5, memory: 10, health: -5, philosophy: 5, sociality: -10
            },
            {
                text: "Использовать самоиронию",
                next: 116,
                clarity: 15, memory: 15, health: 15, philosophy: 5, sociality: 20
            },
            {
                text: "Обратиться к учителям",
                next: 117,
                clarity: 10, memory: 15, health: 10, philosophy: 0, sociality: 5
            }
        ]
    },
    {
        title: "Линейка и Пиджак",
        text: "Я взял металлическую линейку и чуть не зарезал обидчика, потом я порвал ему пиджак. Один раз мне сняли ботинки и разбросали их по классу.\n\nЯ постоянно рассказывал свои идеи по науке, возможно, меня считали занудой. Когда меня стебали, они хотели посмотреть на мою реакцию.",
        choices: [
            {
                text: "Продолжать агрессивно защищаться",
                next: 118,
                clarity: -15, memory: 5, health: -20, philosophy: -15, sociality: -25,
                extreme: true
            },
            {
                text: "Научиться не реагировать",
                next: 119,
                clarity: 10, memory: 15, health: 15, philosophy: 10, sociality: 10
            },
            {
                text: "Найти друзей среди похожих",
                next: 120,
                clarity: 8, memory: 12, health: 10, philosophy: 5, sociality: 20
            },
            {
                text: "Превратить внимание в позитив",
                next: 121,
                clarity: 15, memory: 18, health: 12, philosophy: 8, sociality: 15
            }
        ]
    },
    {
        title: "Напряжение",
        text: "Я относился ко всему слишком серьёзно, я был как будто в замкнутом пространстве, отношение одноклассников ко мне сдавливало меня. Между ними и мной было большое напряжение, я был как натянутая струна, я постоянно был на стороже и ожидал чего–либо негативного с их стороны.\n\nНа переменах я ходил по школе, чтобы не контактировать с ними и мне казалось, что из этой ситуации нет выхода.",
        choices: [
            {
                text: "Продолжать избегать контактов",
                next: 122,
                clarity: -5, memory: 10, health: -10, philosophy: 5, sociality: -20
            },
            {
                text: "Попытаться найти выход из ситуации",
                next: 123,
                clarity: 15, memory: 15, health: 10, philosophy: 10, sociality: 10
            },
            {
                text: "Искать поддержку у других",
                next: 124,
                clarity: 10, memory: 12, health: 12, philosophy: 5, sociality: 18
            },
            {
                text: "Найти баланс между защитой и открытостью",
                next: 125,
                clarity: 12, memory: 15, health: 12, philosophy: 8, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Маньяк в лесу",
        text: "В детстве был момент, когда на меня с матерью напал маньяк, я сидел на дереве и молился, позже маньяк отпустил нас. Был момент, когда на меня напали ребята в парке, чтобы обокрасть.\n\nТакже в Южном Бутове, недалеко от моего дома, на меня напал гопник. Я сказал, что мои родители уехали и оставили мне только двести рублей, мы разделили деньги по половине и разошлись.",
        choices: [
            {
                text: "Стать более осторожным",
                next: 126,
                clarity: 10, memory: 15, health: 5, philosophy: 5, sociality: -5
            },
            {
                text: "Попытаться забыть о страхах",
                next: 127,
                clarity: -5, memory: 5, health: -10, philosophy: -5, sociality: 10
            },
            {
                text: "Найти способ защиты",
                next: 128,
                clarity: 15, memory: 10, health: 15, philosophy: 5, sociality: 5
            },
            {
                text: "Обратиться за помощью",
                next: 129,
                clarity: 12, memory: 12, health: 12, philosophy: 5, sociality: 15
            }
        ]
    },
    {
        title: "Травмы детства",
        text: "Был случай когда мы играли в игру с закрытыми глазами на улице, я шёл в полной темноте и упал в подвальное помещение дома, прямо головой вниз, на осколки бутылок. Был случай, когда я схватился за горячий утюг и сильно обжёг руку.\n\nБыл случай дома, падал шкаф, у него открылась дверца и я попал в пустое пространство. Был случай, когда я горячую баночку с перекисью водорода подставил под воду, она взорвалась и осколки порезали мои ноги.",
        choices: [
            {
                text: "Стать более осторожным",
                next: 130,
                clarity: 10, memory: 15, health: 10, philosophy: 5, sociality: -5
            },
            {
                text: "Продолжать экспериментировать",
                next: 131,
                clarity: -5, memory: 20, health: -15, philosophy: 15, sociality: -10
            },
            {
                text: "Изучать безопасность",
                next: 132,
                clarity: 15, memory: 18, health: 15, philosophy: 10, sociality: 5,
                achievement: "scholar"
            },
            {
                text: "Найти баланс между любопытством и безопасностью",
                next: 133,
                clarity: 12, memory: 17, health: 12, philosophy: 10, sociality: 8,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Друг C: Сатанизм",
        text: "Итак, десятый класс, меня жёстко стебут, отнимают личные вещи, пишут в моих тетрадях, но к концу года я смог восстановить отношение с одним из моих прошлых друзей «C». Он изучал сатанизм, и мы провели много времени в обсуждении его и многих других тем.\n\nЯ нейтрально относился к мнениям других людей, был толерантным ко всему, был против дискриминации, был непредвзят и беспристрастен и принял моего друга таким какой он есть.",
        choices: [
            {
                text: "Изучать сатанизм вместе",
                next: 134,
                clarity: -15, memory: 20, health: -20, philosophy: 25, sociality: -15,
                extreme: true
            },
            {
                text: "Принять друга, но не его философию",
                next: 135,
                clarity: 10, memory: 15, health: 10, philosophy: 5, sociality: 15
            },
            {
                text: "Найти баланс между принятием и своими ценностями",
                next: 136,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            },
            {
                text: "Попытаться помочь другу",
                next: 137,
                clarity: 15, memory: 15, health: 12, philosophy: 10, sociality: 18
            }
        ]
    },
    {
        title: "Гедонизм",
        text: "По мере общения с другом «C» я осознал, что предвзятости, предрассудки и суеверия — это психологические ограничения, а религия и закон — средства контроля. Я не хотел принимать участие в социальных играх.\n\nЯ стал выворачивать свои взгляды наизнанку. Я решил быть гедонистом. Я решил, что моя моральность — причина издевательств надо мной со стороны одноклассников.",
        choices: [
            {
                text: "Полностью принять гедонизм",
                next: 138,
                clarity: -10, memory: 15, health: -15, philosophy: 20, sociality: -10,
                extreme: true
            },
            {
                text: "Найти умеренный гедонизм",
                next: 139,
                clarity: 10, memory: 15, health: 8, philosophy: 12, sociality: 10
            },
            {
                text: "Сохранить некоторые моральные принципы",
                next: 140,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 12
            },
            {
                text: "Найти баланс между удовольствием и моралью",
                next: 141,
                clarity: 12, memory: 15, health: 12, philosophy: 12, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Друг C: Планы убийства",
        text: "Друг С продумывал сценарии убийства и был иногда экспрессивен в этом смысле, он рассказывал, что хочет убить человека, я говорил ему, что ему не повезло родиться с такой естественной предрасположенностью.\n\nНо в глубине души я хотел отвадить его от мыслей об убийстве. Я всё ещё не был в состоянии общаться на эту тему, но потом очерствел, что-то во мне переменилось и разговоры об убийствах стали для меня чем-то нормальным.",
        choices: [
            {
                text: "Принять и оправдать его мысли",
                next: 142,
                clarity: -20, memory: 15, health: -25, philosophy: 15, sociality: -25,
                extreme: true
            },
            {
                text: "Попытаться помочь ему",
                next: 143,
                clarity: 15, memory: 15, health: 12, philosophy: 10, sociality: 18
            },
            {
                text: "Дистанцироваться",
                next: 144,
                clarity: 10, memory: 10, health: 15, philosophy: 5, sociality: 5
            },
            {
                text: "Найти баланс между принятием и границами",
                next: 145,
                clarity: 12, memory: 12, health: 12, philosophy: 8, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Индивидуализм",
        text: "Общаясь дальше со своим другом «C» я решил стать индивидуалистом, также меня интересовали возможности по самоконтролю. Мы с другом часто обсуждали способы получения удовольствия из «пустоты», также мне казалось, что когда я вибрирую рукой, в ней выделяется энергия.\n\nСо временем я понял, что мораль относительна и я могу без проблем ударить обидчика стулом.",
        choices: [
            {
                text: "Стать полным индивидуалистом",
                next: 146,
                clarity: -10, memory: 15, health: -10, philosophy: 20, sociality: -20,
                extreme: true
            },
            {
                text: "Сохранить связь с другими",
                next: 147,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15
            },
            {
                text: "Найти умеренный индивидуализм",
                next: 148,
                clarity: 10, memory: 15, health: 10, philosophy: 15, sociality: 10
            },
            {
                text: "Балансировать между индивидуальностью и общностью",
                next: 149,
                clarity: 12, memory: 15, health: 12, philosophy: 12, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Цинизм",
        text: "Я стремился к максимальной свободе в мышлении. Я стал очень циничным. Я ни на кого не надеялся, кроме самого себя, я никого ни в чём не обвинял, я считал, что мне никто ничего не должен и я никому ничего не должен.\n\nЯ стремился лишь к удовольствию и не видел смысла кому-либо помогать, стремился только к личной выгоде, я негативно относился к понятию семьи и детям.",
        choices: [
            {
                text: "Углубиться в цинизм",
                next: 150,
                clarity: -15, memory: 15, health: -20, philosophy: 25, sociality: -25,
                extreme: true
            },
            {
                text: "Найти смысл в помощи другим",
                next: 151,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 20
            },
            {
                text: "Принять умеренный эгоизм",
                next: 152,
                clarity: 10, memory: 12, health: 10, philosophy: 12, sociality: 10
            },
            {
                text: "Найти баланс между эгоизмом и альтруизмом",
                next: 153,
                clarity: 12, memory: 14, health: 12, philosophy: 12, sociality: 15,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Программирование",
        text: "В десятом классе я изучал системное администрирование, программировал на Python, устанавливал сотни программ на свою приставку, телефон, по инструкциям взламывал устройства, перепрошивал, всё это было очень навязчиво.\n\nЯ протестовал против денег, общепринятого, рациональной траты времени, да и вообще рациональности; я постоянно размышлял, строил логические цепочки.",
        choices: [
            {
                text: "Погрузиться в программирование полностью",
                next: 154,
                clarity: 10, memory: 25, health: -10, philosophy: 15, sociality: -15,
                achievement: "scholar"
            },
            {
                text: "Использовать программирование для пользы",
                next: 155,
                clarity: 12, memory: 20, health: 10, philosophy: 10, sociality: 10
            },
            {
                text: "Найти баланс между хобби и жизнью",
                next: 156,
                clarity: 12, memory: 18, health: 12, philosophy: 12, sociality: 12,
                achievement: "balanced"
            },
            {
                text: "Ограничить навязчивость",
                next: 157,
                clarity: 15, memory: 15, health: 15, philosophy: 5, sociality: 15
            }
        ]
    },
    {
        title: "Репутация в школе",
        text: "В школе после той стычки меня перестали стебать и я даже заимел некоторую репутацию, став играть в школьной группе. Я был ироничен, проявлял сарказм.\n\nПредставлял извращённые, относительные, парадоксальные, разрушающие шаблон картины, представлял жестокие и пошлые образы. Изучал автобиографии маньяков, никому не доверял.",
        choices: [
            {
                text: "Использовать репутацию для власти",
                next: 158,
                clarity: -10, memory: 10, health: -10, philosophy: 15, sociality: 10,
                extreme: true
            },
            {
                text: "Использовать репутацию для дружбы",
                next: 159,
                clarity: 10, memory: 10, health: 10, philosophy: 5, sociality: 20
            },
            {
                text: "Остаться собой",
                next: 160,
                clarity: 12, memory: 12, health: 12, philosophy: 10, sociality: 12
            },
            {
                text: "Найти баланс между репутацией и искренностью",
                next: 161,
                clarity: 12, memory: 12, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Университет: Популярность",
        text: "В университете, после первого академического отпуска я много думал насчёт того, как заиметь репутацию в обществе. Я пришёл к выводу, что надо вызывать зависимость у людей от того добра, что ты им делаешь, и не стесняться делиться всем чем можно.\n\nЯ проводил эксперименты над людьми. Хотел менять свои личности и смотреть за реакцией людей. Пытался растлить одного одногруппника.",
        choices: [
            {
                text: "Продолжать эксперименты",
                next: 162,
                clarity: -15, memory: 15, health: -20, philosophy: 20, sociality: 10,
                extreme: true
            },
            {
                text: "Использовать популярность для добра",
                next: 163,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 20
            },
            {
                text: "Найти настоящую дружбу",
                next: 164,
                clarity: 12, memory: 15, health: 12, philosophy: 8, sociality: 18
            },
            {
                text: "Найти баланс между популярностью и искренностью",
                next: 165,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Университет: Эпатаж",
        text: "Я старался вести себя как можно эпатажнее. Бухал и блевал. Приходил пьяный на пары и блевал в университете. Я был трикстером, и это принесло мне некоторую популярность.\n\nВсё это было не потому, что я золотой ребёнок, как может показаться; всё это было продумано и спланировано. Это было частью эпатажа, я хотел вызвать как можно больше удивления и наладить отношения с другими людьми.",
        choices: [
            {
                text: "Продолжать эпатаж",
                next: 166,
                clarity: -10, memory: 10, health: -20, philosophy: 10, sociality: 15,
                extreme: true
            },
            {
                text: "Стать более искренним",
                next: 167,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 18
            },
            {
                text: "Найти баланс между эпатажем и нормальностью",
                next: 168,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            },
            {
                text: "Сосредоточиться на учёбе",
                next: 169,
                clarity: 15, memory: 25, health: 15, philosophy: 10, sociality: -10,
                achievement: "scholar"
            }
        ]
    },
    {
        title: "Лидерство",
        text: "Я хотел дружить со всеми, быть любимым всеми, даже властвовать, к каждому искал свой подход и у меня получалось, я стал почти что лидером.\n\nЯ постоянно веселился. Но я не из тех людей, кто занимается такими вещами искренне. Всё это было продумано и спланировано.",
        choices: [
            {
                text: "Использовать лидерство для власти",
                next: 170,
                clarity: -10, memory: 10, health: -10, philosophy: 15, sociality: 15,
                extreme: true
            },
            {
                text: "Использовать лидерство для помощи другим",
                next: 171,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 20
            },
            {
                text: "Найти искренние отношения",
                next: 172,
                clarity: 12, memory: 15, health: 12, philosophy: 8, sociality: 18
            },
            {
                text: "Найти баланс между лидерством и равенством",
                next: 173,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Любовь: Девушка в школе",
        text: "В школе я полюбил одну девушку, и это сделало меня намного социальнее и добрее, я писал ей очень приятные вещи, говорил ей, что если она выберет другого я буду счастлив за неё, настолько я её любил, но моя нежность не всегда была нужна ей, иногда ей хотелось драмы.\n\nПри общении с ней, она выбрала другого человека — моего товарища «E», мне же говорила, что хочет, чтобы мы были просто друзьями.",
        choices: [
            {
                text: "Продолжать надеяться",
                next: 174,
                clarity: -10, memory: 15, health: -10, philosophy: -5, sociality: 5
            },
            {
                text: "Порвать с ней и двигаться дальше",
                next: 175,
                clarity: 15, memory: 10, health: 15, philosophy: 10, sociality: 10
            },
            {
                text: "Принять дружбу",
                next: 176,
                clarity: 10, memory: 15, health: 12, philosophy: 8, sociality: 15
            },
            {
                text: "Найти баланс между чувствами и реальностью",
                next: 177,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Безответная любовь",
        text: "Она не отвечала нет, не хотела потерять меня, как друга, но и не говорила да, это не позволяло мне разлюбить её и с каждым днём я привязывался к ней всё больше и больше, невыносимость безответной любви всё росла.\n\nПотом я сам порвал с ней, удалил все сообщения и перестал с ней общаться. Я искал другой способ получения удовольствия и рассматривал любовь, как наркотическую зависимость.",
        choices: [
            {
                text: "Бороться с зависимостью от любви",
                next: 178,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 10
            },
            {
                text: "Искать новую любовь",
                next: 179,
                clarity: 5, memory: 10, health: 10, philosophy: 5, sociality: 15
            },
            {
                text: "Сосредоточиться на других вещах",
                next: 180,
                clarity: 15, memory: 20, health: 15, philosophy: 15, sociality: 5
            },
            {
                text: "Найти баланс между чувствами и жизнью",
                next: 181,
                clarity: 12, memory: 15, health: 12, philosophy: 12, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Университет: Девушка A",
        text: "В университете я полюбил другую девушку «A», когда мы общались она говорила: «вот бы у меня был такой парень, как ты», мы много общались, обсуждали физику, её отношение с её бывшим, мне казалось, что у неё нет парня, я очень сильно полюбил её, но всё закончилось тем же самым, оказалось, что у неё есть парень.",
        choices: [
            {
                text: "Принять реальность",
                next: 182,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 12
            },
            {
                text: "Бороться за неё",
                next: 183,
                clarity: -10, memory: 10, health: -15, philosophy: -10, sociality: -10,
                extreme: true
            },
            {
                text: "Остаться друзьями",
                next: 184,
                clarity: 12, memory: 15, health: 12, philosophy: 8, sociality: 18
            },
            {
                text: "Найти баланс между чувствами и дружбой",
                next: 185,
                clarity: 12, memory: 15, health: 12, philosophy: 10, sociality: 15,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Признание в любви",
        text: "Я хотел поцеловать её, угрожал, что спишусь с её партнёром, добавлял в чёрный список, я понял, что она не ответит мне ни да, ни нет и сам отменил своё предложение встречаться, и также очень страдал.\n\nМоя подруга «B» говорила, что талантливый человек талантлив во всём; я обладал некоторым красноречием и помогал другим с программированием и инженерной графикой.",
        choices: [
            {
                text: "Продолжать страдать",
                next: 186,
                clarity: -10, memory: 15, health: -15, philosophy: -5, sociality: -5
            },
            {
                text: "Принять и двигаться дальше",
                next: 187,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 12
            },
            {
                text: "Использовать страдания для творчества",
                next: 188,
                clarity: 10, memory: 20, health: 10, philosophy: 15, sociality: 8
            },
            {
                text: "Найти баланс между чувствами и принятием",
                next: 189,
                clarity: 12, memory: 15, health: 12, philosophy: 12, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Преподаватели",
        text: "Преподаватель аналитической геометрии хотел совместно заниматься научной работой, преподаватель по информационным технологиям предлагал работу в университете, проректор хотел взять меня в команду с другом F для работы над университетским научным проектом.\n\nПреподаватель по русскому языку и культуре речи без иронии называла меня гением. Мой друг E, философ, называл меня вундеркиндом средней руки.",
        choices: [
            {
                text: "Принять научные предложения",
                next: 190,
                clarity: 15, memory: 25, health: 10, philosophy: 15, sociality: 5,
                achievement: "scholar"
            },
            {
                text: "Сосредоточиться на учёбе",
                next: 191,
                clarity: 12, memory: 25, health: 12, philosophy: 10, sociality: 0
            },
            {
                text: "Найти баланс между наукой и жизнью",
                next: 192,
                clarity: 12, memory: 22, health: 12, philosophy: 12, sociality: 10,
                achievement: "balanced"
            },
            {
                text: "Продолжать быть обычным",
                next: 193,
                clarity: 10, memory: 15, health: 15, philosophy: 8, sociality: 15
            }
        ]
    },
    {
        title: "Друг F",
        text: "Друг F был обладателем выдающегося ума, был лучшим на потоке, плохо запоминал имена, был очень рациональным и эффективным, постоянно приходил в университет в новом образе, мы с ним обсуждали релятивизм, философию сознания, парадоксальность.\n\nСам же я считал себя обычным человеком. Мне казалось, что моё будущее обеспечено.",
        choices: [
            {
                text: "Работать вместе над проектом",
                next: 194,
                clarity: 12, memory: 25, health: 10, philosophy: 20, sociality: 10,
                achievement: "scholar"
            },
            {
                text: "Продолжать философские дискуссии",
                next: 195,
                clarity: -5, memory: 20, health: -5, philosophy: 25, sociality: 5
            },
            {
                text: "Найти баланс между проектом и общением",
                next: 196,
                clarity: 12, memory: 22, health: 12, philosophy: 18, sociality: 12,
                achievement: "balanced"
            },
            {
                text: "Оставаться собой",
                next: 197,
                clarity: 10, memory: 18, health: 12, philosophy: 12, sociality: 12
            }
        ]
    },
    {
        title: "Первый психоз: Ускорение",
        text: "Когда я приехал домой, я соврал, сказав, что я немного выпил с друзьями. Мне казалось, что я ускорен, а время замедлилось.\n\nМне казалось, что друзья сделали мне лоботомию при приёме MDA, и что в моём горле нарост. Мне казалось, что я научился чувствовать свой мозг, что я стал богом и могу управлять погодой.",
        choices: [
            {
                text: "Поверить в новые способности",
                next: 198,
                clarity: -25, memory: 30, health: -30, philosophy: 40, sociality: -25,
                extreme: true
            },
            {
                text: "Попытаться вернуться в реальность",
                next: 199,
                clarity: 20, memory: 25, health: 20, philosophy: -10, sociality: 15
            },
            {
                text: "Искать помощь",
                next: 200,
                clarity: 25, memory: 30, health: 30, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между реальностью и опытом",
                next: 201,
                clarity: 15, memory: 20, health: 18, philosophy: 15, sociality: 12
            }
        ]
    },
    {
        title: "Первый психоз: Вампир-рептилоид",
        text: "Мне казалось, что я возымел мистическое зрение, что я вампир-рептилоид. В состоянии опьянения делал кувырки по комнате. Воображал, что я бог, лёг на пол и мне казалось, что я излучаю энергию.\n\nПотом начал проявлять сарказм по отношению к своим оппонентам. Позже вместо подруги я увидел «демона» с жирным телом.",
        choices: [
            {
                text: "Принять новую идентичность",
                next: 202,
                clarity: -30, memory: 35, health: -40, philosophy: 45, sociality: -35,
                extreme: true
            },
            {
                text: "Бороться с бредом",
                next: 203,
                clarity: 25, memory: 30, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Искать медицинскую помощь",
                next: 204,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между опытом и реальностью",
                next: 205,
                clarity: 15, memory: 25, health: 18, philosophy: 18, sociality: 15
            }
        ]
    },
    {
        title: "Психоз: Деконструкция",
        text: "Я постоянно выводил что-то новое и при этом говорил себе этого не делать, был онанистом в мысли, резонёром, у меня была метафизическая интоксикация. Я искал во всём смысл, причину, основу.\n\nБез остановки мыслил логически, мыслил в крайность, был демагогом, занимался бесплодным мудрствованием, графоманией.",
        choices: [
            {
                text: "Продолжать деконструировать",
                next: 206,
                clarity: -30, memory: 40, health: -35, philosophy: 45, sociality: -30,
                extreme: true
            },
            {
                text: "Попытаться остановить",
                next: 207,
                clarity: 20, memory: 20, health: 20, philosophy: -15, sociality: 15
            },
            {
                text: "Искать помощь",
                next: 208,
                clarity: 25, memory: 30, health: 30, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между мышлением и покоем",
                next: 209,
                clarity: 15, memory: 25, health: 18, philosophy: 20, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Психоз: Мыслительный онанизм",
        text: "При мысленном онанизме наступает момент когда энергия истощается и это приводит к зацикливанию. При постоянном мышлении время течёт очень быстро.\n\nЯ стремился формулировать всё содержимое психики в словах, каждую тонкость. Уровень моей логики дошёл до планки, когда оформить мысль в словах не представлялось возможным.",
        choices: [
            {
                text: "Продолжать мыслить до предела",
                next: 210,
                clarity: -35, memory: 45, health: -40, philosophy: 50, sociality: -35,
                extreme: true
            },
            {
                text: "Остановить мышление",
                next: 211,
                clarity: 25, memory: 15, health: 25, philosophy: -20, sociality: 15
            },
            {
                text: "Использовать образное мышление",
                next: 212,
                clarity: 18, memory: 20, health: 20, philosophy: 15, sociality: 10
            },
            {
                text: "Найти баланс между мышлением и покоем",
                next: 213,
                clarity: 15, memory: 22, health: 18, philosophy: 18, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Психоз: Иллюзорный мир",
        text: "Я строил свой иллюзорный мир, в будущем он и подавленные эмоции нашли выход в первом психозе. Я занимался интеллектуализацией, убирал эмоциональную составляющую эмоций и постоянно рационализировал и теоретизировал, чтобы снизить свою чувствительность.\n\nЯ создавал иллюзорные миры, чтобы изолироваться от внешнего мира, Также я был очень инертным.",
        choices: [
            {
                text: "Углубиться в иллюзорный мир",
                next: 214,
                clarity: -30, memory: 35, health: -35, philosophy: 40, sociality: -35,
                extreme: true
            },
            {
                text: "Вернуться в реальный мир",
                next: 215,
                clarity: 25, memory: 25, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Использовать мир для творчества",
                next: 216,
                clarity: 10, memory: 25, health: 10, philosophy: 25, sociality: 5
            },
            {
                text: "Найти баланс между реальностью и фантазией",
                next: 217,
                clarity: 15, memory: 20, health: 18, philosophy: 18, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Психоз: Двойник",
        text: "В Сочи я наткнулся на страницу одной девушки в вк и мне показалось, что она мой двойник, что и у меня и у неё раздвоение личности и что с одной стороны мы чувственные, рефлексивные, аутичные дети индиго, а с другой стороны — грубые и пошлые.\n\nМне казалось, что я телепатически общаюсь с ней и её друзьями. Я увидел её видео на youtube, и у меня началось длительное затяжное дежавю.",
        choices: [
            {
                text: "Поверить в связь с двойником",
                next: 218,
                clarity: -25, memory: 30, health: -30, philosophy: 35, sociality: -25,
                extreme: true
            },
            {
                text: "Попытаться вернуться в реальность",
                next: 219,
                clarity: 20, memory: 25, health: 20, philosophy: -10, sociality: 15,
                achievement: "survivor"
            },
            {
                text: "Искать медицинскую помощь",
                next: 220,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между фантазией и реальностью",
                next: 221,
                clarity: 15, memory: 22, health: 18, philosophy: 18, sociality: 12
            }
        ]
    },
    {
        title: "Встреча с двойником",
        text: "Когда я приехал в Москву, я поехал на метро к месту встречи, там я на станции смотрел в камеру и мне казалось, что я попал в астральный мир и что я нахожусь на очень высоком уровне развития.\n\nПотом сотрудники метро привели меня к себе и стали меня расспрашивать. Потом отпустили, и я поехал домой. Дома я разговаривал с книгами.",
        choices: [
            {
                text: "Продолжать верить в встречу",
                next: 222,
                clarity: -25, memory: 30, health: -30, philosophy: 35, sociality: -25,
                extreme: true
            },
            {
                text: "Понять, что это бред",
                next: 223,
                clarity: 25, memory: 30, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Искать помощь после инцидента",
                next: 224,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между опытом и реальностью",
                next: 225,
                clarity: 18, memory: 22, health: 20, philosophy: 18, sociality: 15
            }
        ]
    },
    {
        title: "Больница",
        text: "Меня отвезли в больницу. В больнице мне стали давать уколы аминазина, потом зипрексу. Мой метаболизм нарушился, я располнел, а психоз сошёл на нет.\n\nВ больнице мне казалось, что мои друзья помогают мне справится с тем, что я ощущал в больнице. Так же мне казалось, что буддисты поедают людей.",
        choices: [
            {
                text: "Принять лечение",
                next: 226,
                clarity: 25, memory: 30, health: 30, philosophy: -15, sociality: 25,
                achievement: "survivor"
            },
            {
                text: "Сопротивляться лечению",
                next: 227,
                clarity: -20, memory: 15, health: -25, philosophy: 25, sociality: -20,
                extreme: true
            },
            {
                text: "Найти баланс между лечением и собой",
                next: 228,
                clarity: 20, memory: 25, health: 22, philosophy: 12, sociality: 20,
                achievement: "balanced"
            },
            {
                text: "Использовать опыт для понимания",
                next: 229,
                clarity: 18, memory: 25, health: 18, philosophy: 20, sociality: 15
            }
        ]
    },
    {
        title: "Второй психоз: Телепатия",
        text: "Мне казалось, что я телепатически соединён со многими людьми, они виртуально вкалывают в меня разнообразные наркотические вещества, и я переживаю слабый воображаемый trip.\n\nМне казалось, что разговариваю с так называемыми «судьями», которые в каком-то смысле являются ангелами, которые используют идеальную версию библии для того, чтобы судить людей.",
        choices: [
            {
                text: "Поверить в телепатию",
                next: 230,
                clarity: -25, memory: 30, health: -30, philosophy: 35, sociality: -25,
                extreme: true
            },
            {
                text: "Попытаться вернуться в реальность",
                next: 231,
                clarity: 20, memory: 25, health: 20, philosophy: -10, sociality: 15,
                achievement: "survivor"
            },
            {
                text: "Искать медицинскую помощь",
                next: 232,
                clarity: 30, memory: 35, health: 35, philosophy: -15, sociality: 30,
                achievement: "survivor"
            },
            {
                text: "Найти баланс",
                next: 233,
                clarity: 15, memory: 22, health: 18, philosophy: 20, sociality: 15
            }
        ]
    },
    {
        title: "Второй психоз: Флюид и Фотон",
        text: "Мне казалось, что каждый человек представляет из себя мировую идею, слово и волну, и каждой вещи есть в соответствии идея, выражающаяся антропоморфно. Что человек после смерти превращается либо во флюид, если он зло, либо в фотон, если он добро.\n\nФлюид движется со скоростью, близкой к скорости света, он сосредоточие эгоизма, играет и творит шалости, а фотон работает, для него время не течёт.",
        choices: [
            {
                text: "Поверить в эту систему",
                next: 234,
                clarity: -30, memory: 35, health: -35, philosophy: 45, sociality: -30,
                extreme: true
            },
            {
                text: "Вернуться в реальность",
                next: 235,
                clarity: 25, memory: 30, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Использовать идеи для философии",
                next: 236,
                clarity: 10, memory: 25, health: 10, philosophy: 30, sociality: 5
            },
            {
                text: "Найти баланс",
                next: 237,
                clarity: 18, memory: 22, health: 20, philosophy: 22, sociality: 15
            }
        ]
    },
    {
        title: "Второй психоз: Кристалл",
        text: "Мне казалось, что на каждом уровне абстракции есть существа. На одном из высоких уровней абстракции есть такое существо, как кристалл — это топологическая структура, математическая, цифровая, структура реального времени.\n\nТакже есть и другие структуры, например, экспонента, которая распадается на волны-струны. Волны — это двоичная логика, а экспонента находится на более высоком уровне.",
        choices: [
            {
                text: "Погрузиться в абстракции",
                next: 238,
                clarity: -25, memory: 30, health: -30, philosophy: 40, sociality: -25,
                extreme: true
            },
            {
                text: "Вернуться к конкретному",
                next: 239,
                clarity: 25, memory: 25, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Использовать идеи в науке",
                next: 240,
                clarity: 12, memory: 25, health: 12, philosophy: 25, sociality: 8,
                achievement: "scholar"
            },
            {
                text: "Найти баланс между абстрактным и конкретным",
                next: 241,
                clarity: 18, memory: 22, health: 18, philosophy: 22, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Второй психоз: Дельфины",
        text: "Также я кидал воображаемый дайс, чтобы выявить характеристики тех или иных объектов. Так я выявил, как мне казалось, уровень интеллекта у змей и дельфинов, который оказался выше человеческого.\n\nДа и вообще мне казалось, что дельфины управляют миром. Также мне казалось, что если я открою вкладку на компьютере о Будде медицины, то он будет лечить меня.",
        choices: [
            {
                text: "Поверить в дельфинов",
                next: 242,
                clarity: -25, memory: 30, health: -30, philosophy: 35, sociality: -30,
                extreme: true
            },
            {
                text: "Вернуться в реальность",
                next: 243,
                clarity: 25, memory: 25, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Использовать идеи для размышлений",
                next: 244,
                clarity: 10, memory: 22, health: 10, philosophy: 25, sociality: 5
            },
            {
                text: "Найти баланс",
                next: 245,
                clarity: 18, memory: 22, health: 18, philosophy: 20, sociality: 12
            }
        ]
    },
    {
        title: "Второй психоз: Медитация",
        text: "Я лежал на кровати медитировал и ощущал, как мысленные «завихрения» расправлялись. На улице же я встречал людей в синем и часто лил дождь.\n\nТакже, когда я находился на кладбище, мне задавали вопрос: «ты что, медиум?». На кладбище мне казалось, что я разговариваю с умершими.",
        choices: [
            {
                text: "Продолжать медитировать",
                next: 246,
                clarity: 10, memory: 15, health: 10, philosophy: 20, sociality: -10
            },
            {
                text: "Остановить медитацию",
                next: 247,
                clarity: 20, memory: 20, health: 20, philosophy: -10, sociality: 15,
                achievement: "survivor"
            },
            {
                text: "Найти умеренную медитацию",
                next: 248,
                clarity: 15, memory: 18, health: 15, philosophy: 15, sociality: 10,
                achievement: "balanced"
            },
            {
                text: "Использовать опыт для понимания",
                next: 249,
                clarity: 12, memory: 20, health: 12, philosophy: 18, sociality: 12
            }
        ]
    },
    {
        title: "Третий психоз: Ограничения",
        text: "Сложно глотать. Снова кажется, что будет плохо, если далеко окажусь от дома или же буду заниматься какой-либо деятельностью сравнительно недолгое время.\n\nПока гуляю, примечаю многие вещи и проецирую их в своё состояние. Кажется, что обстановка на улице становится с каждой минутой всё экстремальнее.",
        choices: [
            {
                text: "Максимально ограничить деятельность",
                next: 250,
                clarity: 15, memory: 10, health: 20, philosophy: -15, sociality: -10
            },
            {
                text: "Попытаться преодолеть ограничения",
                next: 251,
                clarity: 20, memory: 15, health: 15, philosophy: 10, sociality: 15,
                achievement: "survivor"
            },
            {
                text: "Искать медицинскую помощь",
                next: 252,
                clarity: 25, memory: 20, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Найти баланс между ограничениями и свободой",
                next: 253,
                clarity: 18, memory: 15, health: 20, philosophy: 8, sociality: 12,
                achievement: "balanced"
            }
        ]
    },
    {
        title: "Третий психоз: Православие",
        text: "В третьем психозе, как и во втором, у меня возникал страх бога и я уходил в православие. Постоянно слушал и читал молитвы. Изучал библию. Слушал лекции духовной семинарии, пытался как можно глубже понять христианство.\n\nПо какой-то причине единственное чем я мог заниматься это православием, когда я занимался чем-то другим, то не мог это делать больше десяти минут.",
        choices: [
            {
                text: "Углубиться в православие",
                next: 254,
                clarity: 5, memory: 15, health: 10, philosophy: -20, sociality: 10
            },
            {
                text: "Найти баланс с верой",
                next: 255,
                clarity: 15, memory: 15, health: 15, philosophy: 10, sociality: 12,
                achievement: "balanced"
            },
            {
                text: "Искать светскую помощь",
                next: 256,
                clarity: 25, memory: 20, health: 25, philosophy: -15, sociality: 20,
                achievement: "survivor"
            },
            {
                text: "Принять умеренную веру",
                next: 257,
                clarity: 18, memory: 18, health: 18, philosophy: 5, sociality: 15
            }
        ]
    },
    {
        title: "Решающий момент",
        text: "Время решений пришло. Твой путь подходит к концу, и перед тобой открываются различные возможности.\n\nВсё зависит от того, какой путь ты выбрал, какие решения принимал, и где находишься сейчас. Каждый выбор привёл тебя сюда. Каждый момент определил твоё состояние. Твой путь подошёл к концу, но жизнь продолжается.",
        choices: [
            {
                text: "Продолжить свой путь...",
                next: -1, // Специальный маркер для определения концовки
                checkEnding: true,
                clarity: 0, memory: 0, health: 0, philosophy: 0, sociality: 0
            }
        ]
    }
];

// Система концовок
const endings = {
    good: {
        id: "good",
        title: "Хорошая концовка: Принятие и Гармония",
        text: "Ты нашёл баланс в своей жизни. Приняв свои особенности и научившись с ними жить, ты достиг гармонии.\n\nТы не отрицаешь свою болезнь, но и не позволяешь ей полностью управлять тобой. Ты научился различать реальность и иллюзию, сохранил связи с близкими и нашёл смысл в простых вещах.\n\nПутешествие продолжается, но теперь ты знаешь, куда идёшь. Мир всё ещё сложен и неопределён, но ты научился находить в этом красоту.\n\n«Я достиг гармонии, счастья, я практически не мыслю, не мыслю о прошлом и будущем, живу здесь и сейчас, меня всё устраивает.»",
        requirements: {
            health: [40, 100],
            clarity: [40, 100],
            sociality: [40, 100],
            balancedPath: true
        }
    },
    true: {
        id: "true",
        title: "Истинная концовка: Путь к Себе",
        text: "Ты прошёл через всё и остался собой. Не идеальным, не сломленным, но настоящим.\n\nТы принял свою шизофрению как часть себя, не прячешься от неё и не позволяешь ей поглотить тебя полностью. Ты научился жить с ней, находить моменты ясности и использовать их.\n\nТы не герой и не жертва. Ты просто человек, который прошёл через тяжёлый путь и выжил. Возможно, это и есть истина - не победа над болезнью, а жизнь с ней.\n\n«Я принял свою жизнь такой, какой она есть. До шизофрении я был в тюрьме своего прошлого. Первый психоз всё стер и освободил от этого.»",
        requirements: {
            philosophy: [50, 100],
            clarity: [30, 80],
            survivor: true
        }
    },
    bad: {
        id: "bad",
        title: "Плохая концовка: Потеря",
        text: "Ты потерял слишком много. Психоз поглотил тебя, реальность растворилась в бреде.\n\nТы больше не можешь отличить, что реально, а что нет. Друзья стали врагами, близкие - двойниками. Каждый день - борьба с голосами, которые звучат громче твоих собственных мыслей.\n\nВозможно, ещё есть надежда. Может быть, лечение поможет. Но сейчас ты в ловушке своего сознания, и выход кажется невозможным.\n\nМир стал враждебным местом, где каждый звук может быть угрозой, каждый взгляд - приговором.",
        requirements: {
            health: [0, 30],
            clarity: [0, 30]
        }
    },
    neutral: {
        id: "neutral",
        title: "Нейтральная концовка: Продолжение",
        text: "Жизнь продолжается. Не лучше, не хуже - просто продолжается.\n\nТы научился справляться с симптомами, находить моменты покоя между эпизодами. Не всегда получается, но ты пытаешься.\n\nНекоторые дни лучше, некоторые хуже. Иногда мир кажется ясным, иногда - полностью искажённым. Но ты живёшь.\n\nВозможно, это и есть нормальность для тебя - постоянное колебание между различными состояниями, поиск баланса, который постоянно ускользает.",
        requirements: {
            default: true
        }
    },
    philosopher: {
        id: "philosopher",
        title: "Концовка Философа: Поиск Истины",
        text: "Ты погрузился в глубины философии и размышлений. Реальность и болезнь стали для тебя не разделимыми понятиями.\n\nТы достиг такого уровня рефлексии, что границы между здоровым сознанием и психозом стёрлись. Вопросы о реальности, сознании и бытии стали главными в твоей жизни.\n\nВозможно, это путь к пониманию чего-то большего. Или возможно, это путь к полной потере связи с миром. Но ты выбрал этот путь сознательно.\n\n«Я ни о чём не мыслю, я мыслю процессами, у меня нет речи, похож ли я на человека, если я использую лишь интуицию?»",
        requirements: {
            philosophy: [80, 100],
            clarity: [20, 60]
        }
    },
    gameOver: {
        id: "gameOver",
        title: "Проигрыш: Критическое состояние",
        text: "Ты не смог выдержать. Психоз стал слишком сильным, реальность полностью потеряна.\n\nПараметры упали до критического уровня. Ты больше не можешь продолжать. Возможно, потребуется госпитализация. Возможно, это конец твоего пути.\n\nНо помни - это всего лишь один из возможных исходов. Каждый путь может быть пройден по-разному.\n\nТы можешь начать заново и попробовать другой подход. Может быть, на этот раз получится лучше.",
        requirements: {
            critical: true
        }
    }
};

// Функция проверки условий проигрыша
function checkGameOver() {
    // Критическое состояние здоровья
    if (gameState.health <= 0) {
        return "gameOver";
    }
    
    // Полная потеря ясности и памяти
    if (gameState.clarity <= 10 && gameState.memory <= 10) {
        return "gameOver";
    }
    
    // Слишком много экстремальных выборов при низком здоровье
    if (gameState.stats.extremeChoices >= 15 && gameState.health <= 20) {
        return "gameOver";
    }
    
    return null;
}

// Функция определения концовки
function determineEnding() {
    // Проверяем проигрыш в первую очередь
    const gameOver = checkGameOver();
    if (gameOver) {
        return endings.gameOver;
    }
    
    // Проверяем специальные концовки
    const stats = {
        health: gameState.health,
        clarity: gameState.clarity,
        memory: gameState.memory,
        philosophy: gameState.philosophy,
        sociality: gameState.sociality,
        balancedPath: gameState.path.balanced >= 5,
        survivor: gameState.health > 0 && gameState.chapter >= 50,
        scholar: gameState.path.scholar >= gameState.path.mystic && gameState.path.scholar >= gameState.path.realist,
        mystic: gameState.path.mystic >= gameState.path.scholar && gameState.path.mystic >= gameState.path.realist,
        realist: gameState.path.realist >= gameState.path.scholar && gameState.path.realist >= gameState.path.mystic
    };
    
    // Концовка Философа
    if (endings.philosopher.requirements.philosophy[0] <= stats.philosophy && 
        stats.philosophy <= endings.philosopher.requirements.philosophy[1] &&
        endings.philosopher.requirements.clarity[0] <= stats.clarity && 
        stats.clarity <= endings.philosopher.requirements.clarity[1]) {
        return endings.philosopher;
    }
    
    // Хорошая концовка
    if (endings.good.requirements.health[0] <= stats.health && 
        stats.health <= endings.good.requirements.health[1] &&
        endings.good.requirements.clarity[0] <= stats.clarity && 
        stats.clarity <= endings.good.requirements.clarity[1] &&
        endings.good.requirements.sociality[0] <= stats.sociality && 
        stats.sociality <= endings.good.requirements.sociality[1] &&
        stats.balancedPath) {
        return endings.good;
    }
    
    // Истинная концовка
    if (endings.true.requirements.philosophy[0] <= stats.philosophy && 
        stats.philosophy <= endings.true.requirements.philosophy[1] &&
        endings.true.requirements.clarity[0] <= stats.clarity && 
        stats.clarity <= endings.true.requirements.clarity[1] &&
        stats.survivor) {
        return endings.true;
    }
    
    // Плохая концовка
    if (stats.health <= endings.bad.requirements.health[1] &&
        stats.clarity <= endings.bad.requirements.clarity[1]) {
        return endings.bad;
    }
    
    // Нейтральная концовка (по умолчанию)
    return endings.neutral;
}

// Вспомогательные функции для проверки достижений
function checkAchievements() {
    // Философ
    if (gameState.philosophy >= 80 && !achievements.philosopher.unlocked) {
        unlockAchievement("philosopher");
    }
    
    // Выживший
    if (gameState.health > 0 && gameState.chapter >= 50 && !achievements.survivor.unlocked) {
        unlockAchievement("survivor");
    }
    
    // Баланс
    const avg = (gameState.clarity + gameState.memory + gameState.health + 
                 gameState.philosophy + gameState.sociality) / 5;
    const diff = Math.max(...[
        gameState.clarity, gameState.memory, gameState.health, 
        gameState.philosophy, gameState.sociality
    ]) - Math.min(...[
        gameState.clarity, gameState.memory, gameState.health, 
        gameState.philosophy, gameState.sociality
    ]);
    if (diff < 20 && avg > 40 && !achievements.balanced.unlocked) {
        unlockAchievement("balanced");
    }
    
    // Экстремист
    if (gameState.stats.extremeChoices >= 10 && !achievements.extreme.unlocked) {
        unlockAchievement("extreme");
    }
}

function unlockAchievement(key) {
    if (!achievements[key].unlocked) {
        achievements[key].unlocked = true;
        gameState.achievements.push(key);
        showNotification(`Достижение разблокировано: ${achievements[key].name}`);
    }
}

function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Сохранение игры
function saveGame() {
    const saveData = {
        ...gameState,
        saveTime: new Date().toISOString()
    };
    localStorage.setItem('schizophreniaGameSave', JSON.stringify(saveData));
    showNotification('Игра сохранена');
}

// Загрузка игры
function loadGame() {
    const saveData = localStorage.getItem('schizophreniaGameSave');
    if (saveData) {
        const data = JSON.parse(saveData);
        Object.assign(gameState, data);
        updateGameScreen();
        showNotification('Игра загружена');
        return true;
    }
    return false;
}

// Инициализация игры
function initGame() {
    if (!loadGame()) {
        updateGameScreen();
    }
    updatePlayTime();
    setInterval(updatePlayTime, 1000);
}

// Обновление времени игры
function updatePlayTime() {
    gameState.playTime++;
    const hours = Math.floor(gameState.playTime / 3600);
    const minutes = Math.floor((gameState.playTime % 3600) / 60);
    const seconds = gameState.playTime % 60;
    const timeDisplay = document.getElementById('play-time');
    if (timeDisplay) {
        timeDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
}

// Система случайных событий
const randomEvents = [
    {
        id: "flashback",
        name: "Воспоминание",
        text: "Внезапно ты вспоминаешь что-то из прошлого...",
        probability: 0.15,
        conditions: { memory: [60, 100] },
        effects: { memory: 5, clarity: 2 }
    },
    {
        id: "insight",
        name: "Озарение",
        text: "К тебе приходит неожиданное понимание...",
        probability: 0.12,
        conditions: { philosophy: [60, 100], clarity: [40, 100] },
        effects: { clarity: 5, philosophy: 3 }
    },
    {
        id: "doubt",
        name: "Сомнение",
        text: "Ты начинаешь сомневаться в реальности происходящего...",
        probability: 0.20,
        conditions: { clarity: [0, 40] },
        effects: { clarity: -3, health: -2 }
    },
    {
        id: "connection",
        name: "Связь",
        text: "Ты чувствуешь связь с другими людьми...",
        probability: 0.18,
        conditions: { sociality: [50, 100] },
        effects: { sociality: 5, health: 3 }
    }
];

// Проверка случайных событий
function checkRandomEvent() {
    const rand = Math.random();
    for (const event of randomEvents) {
        if (rand < event.probability) {
            // Проверяем условия
            const conditions = event.conditions;
            let canTrigger = true;
            for (const [stat, range] of Object.entries(conditions)) {
                const value = gameState[stat];
                if (value < range[0] || value > range[1]) {
                    canTrigger = false;
                    break;
                }
            }
            
            if (canTrigger && !gameState.specialEvents.includes(event.id)) {
                gameState.specialEvents.push(event.id);
                // Применяем эффекты
                for (const [stat, value] of Object.entries(event.effects)) {
                    gameState[stat] = Math.max(0, Math.min(100, gameState[stat] + value));
                }
                showEvent(event);
                return true;
            }
        }
    }
    return false;
}

// Показ события
function showEvent(event) {
    const eventDiv = document.createElement('div');
    eventDiv.className = 'random-event';
    eventDiv.innerHTML = `
        <div class="event-header">✨ ${event.name}</div>
        <div class="event-text">${event.text}</div>
    `;
    document.body.appendChild(eventDiv);
    
    setTimeout(() => eventDiv.classList.add('show'), 100);
    setTimeout(() => {
        eventDiv.classList.remove('show');
        setTimeout(() => eventDiv.remove(), 300);
    }, 4000);
}

// Динамическое изменение текста в зависимости от параметров
function getDynamicText(baseText) {
    let text = baseText;
    
    // Изменения в зависимости от ясности
    if (gameState.clarity < 30) {
        text = text.replace(/\./g, "...");
        if (Math.random() > 0.7) {
            text = "Голоса... " + text;
        }
    }
    
    // Изменения в зависимости от философии
    if (gameState.philosophy > 70 && Math.random() > 0.6) {
        text += "\n\n[Мысль: всё связано со всем...]";
    }
    
    // Изменения в зависимости от здоровья
    if (gameState.health < 30) {
        text += "\n\n[Ты чувствуешь себя слабым...]";
    }
    
    return text;
}

// Поиск скрытых выборов
function findSecretChoices(chapter) {
    const secrets = [];
    
    // Секретный выбор при низкой ясности
    if (gameState.clarity < 20 && Math.random() > 0.8) {
        secrets.push({
            text: "??? [Скрытый путь]",
            next: chapter + 1,
            clarity: -5, memory: 10, health: -5, philosophy: 15, sociality: -10,
            secret: true,
            extreme: true
        });
    }
    
    // Секретный выбор при высокой философии
    if (gameState.philosophy > 80 && Math.random() > 0.7) {
        secrets.push({
            text: "💭 [Философское озарение]",
            next: chapter + 1,
            clarity: 10, memory: 5, health: -10, philosophy: 20, sociality: -15,
            secret: true
        });
    }
    
    return secrets;
}

// Обновление экрана игры
function updateGameScreen() {
    // Проверяем проигрыш перед обновлением экрана
    const gameOver = checkGameOver();
    if (gameOver && !gameState.ending) {
        gameState.ending = "gameOver";
        showEnding(endings.gameOver);
        return;
    }
    
    // Если уже показана концовка, не обновляем
    if (gameState.ending) {
        return;
    }
    
    const currentChapter = chapters[gameState.chapter];
    
    if (!currentChapter) {
        // Если главы нет, определяем концовку
        const ending = determineEnding();
        gameState.ending = ending.id;
        showEnding(ending);
        return;
    }
    
    // Проверяем случайные события
    if (Math.random() > 0.7) {
        checkRandomEvent();
    }
    
    // Обновляем заголовок
    document.getElementById('chapter-title').textContent = currentChapter.title;
    
    // Обновляем текст с динамическими изменениями
    const storyText = document.getElementById('story-text');
    const dynamicText = getDynamicText(currentChapter.text);
    animateText(storyText, dynamicText);
    
    // Удаляем старые классы состояний
    document.body.classList.remove('state-confused', 'state-memory', 'state-philosophy', 
                                    'state-critical', 'state-balanced', 'ending-good', 
                                    'ending-bad', 'ending-true', 'ending-neutral', 
                                    'ending-philosopher', 'ending-gameOver');
    
    // Добавляем класс состояния
    if (gameState.clarity < 30) {
        document.body.classList.add('state-confused');
    } else if (gameState.memory > 70) {
        document.body.classList.add('state-memory');
    } else if (gameState.philosophy > 70) {
        document.body.classList.add('state-philosophy');
    } else if (gameState.health < 30) {
        document.body.classList.add('state-critical');
    } else if (Math.abs(gameState.clarity - gameState.memory) < 10 && 
               Math.abs(gameState.health - 50) < 10) {
        document.body.classList.add('state-balanced');
    }
    
    // Обновляем выборы
    const choicesContainer = document.getElementById('choices-container');
    choicesContainer.innerHTML = '';
    
    if (currentChapter.choices.length === 0) {
        // Конец игры - определяем концовку
        const ending = determineEnding();
        gameState.ending = ending.id;
        showEnding(ending);
    } else {
        // Получаем обычные выборы
        let allChoices = [...currentChapter.choices];
        
        // Ищем скрытые выборы
        const secretChoices = findSecretChoices(gameState.chapter);
        if (secretChoices.length > 0 && !gameState.secrets.includes(gameState.chapter)) {
            allChoices = allChoices.concat(secretChoices);
        }
        
        // Перемешиваем выборы для интриги
        allChoices = shuffleArray(allChoices);
        
        allChoices.forEach((choice, index) => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            if (choice.extreme) {
                button.classList.add('extreme-choice');
            }
            if (choice.secret) {
                button.classList.add('secret-choice');
                gameState.secrets.push(gameState.chapter);
                if (!achievements.explorer.unlocked && gameState.secrets.length >= 5) {
                    unlockAchievement("explorer");
                }
            }
            
            // Визуальное предупреждение о критических выборах
            if (choice.extreme && gameState.health < 30) {
                button.classList.add('danger-choice');
                button.title = "⚠️ Этот выбор может привести к проигрышу!";
            }
            
            // Подсказки для новых игроков (первые 5 глав)
            if (gameState.chapter < 5 && index === 0 && gameState.hints > 0) {
                button.title = "💡 Подсказка: этот выбор относительно безопасен";
            }
            
            button.textContent = choice.text;
            button.onclick = () => makeChoice(choice);
            choicesContainer.appendChild(button);
        });
    }
    
    // Обновляем статистику
    updateStats();
    
    // Проверяем достижения
    checkAchievements();
    
    // Предупреждение при критических параметрах
    if (gameState.health <= 20) {
        showWarning("Критическое состояние здоровья! Будьте осторожны с выбором.");
    }
}

function showWarning(message) {
    const warning = document.createElement('div');
    warning.className = 'warning-notification';
    warning.textContent = message;
    document.body.appendChild(warning);
    
    setTimeout(() => {
        warning.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        warning.classList.remove('show');
        setTimeout(() => warning.remove(), 300);
    }, 5000);
}

// Анимация текста
function animateText(element, text) {
    element.textContent = '';
    element.style.opacity = '0';
    
    setTimeout(() => {
        element.textContent = text;
        element.style.opacity = '1';
    }, 200);
}

// Показ концовки
function showEnding(ending) {
    const textContainer = document.getElementById('text-container');
    const choicesContainer = document.getElementById('choices-container');
    
    // Сохраняем оригинальную структуру перед очисткой
    const originalStructure = textContainer.innerHTML;
    
    // Скрываем обычный текст
    textContainer.innerHTML = '';
    choicesContainer.innerHTML = '';
    
    // Создаём экран концовки
    const endingDiv = document.createElement('div');
    endingDiv.className = 'ending-screen';
    endingDiv.innerHTML = `
        <div class="ending-header">
            <h2 class="ending-title">${ending.title}</h2>
            ${ending.id === 'gameOver' ? '<div class="game-over-indicator">⚠️ ПРОИГРЫШ</div>' : ''}
        </div>
        <div class="ending-text">${ending.text.replace(/\n/g, '<br>')}</div>
        <div class="final-stats">
            <h3>Итоговая статистика</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Глав пройдено:</span>
                    <span class="stat-value">${gameState.chapter + 1}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Выборов сделано:</span>
                    <span class="stat-value">${gameState.stats.totalChoices}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Время игры:</span>
                    <span class="stat-value">${formatTime(gameState.playTime)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Достижений:</span>
                    <span class="stat-value">${gameState.achievements.length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Итоговая ясность:</span>
                    <span class="stat-value">${gameState.clarity}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Итоговое здоровье:</span>
                    <span class="stat-value">${gameState.health}%</span>
                </div>
            </div>
        </div>
        <div class="end-choices">
            <button class="choice-button" onclick="restartGame()">Начать заново</button>
            <button class="choice-button" onclick="toggleMenu()">Просмотреть достижения</button>
        </div>
    `;
    
    textContainer.appendChild(endingDiv);
    
    // Добавляем класс концовки к body для стилизации
    document.body.classList.add(`ending-${ending.id}`);
    
    // Разблокируем достижение за концовку если это не проигрыш
    if (ending.id !== 'gameOver') {
        const endingAchievement = `ending_${ending.id}`;
        if (!gameState.achievements.includes(endingAchievement)) {
            gameState.achievements.push(endingAchievement);
            showNotification(`Концовка достигнута: ${ending.title}`);
        }
    }
}

// Показ экрана окончания (старая функция для совместимости)
function showEndScreen() {
    const ending = determineEnding();
    gameState.ending = ending.id;
    showEnding(ending);
}

function formatTime(seconds) {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
}

function calculateFinalStats() {
    return {
        clarity: gameState.clarity,
        memory: gameState.memory,
        health: gameState.health,
        philosophy: gameState.philosophy,
        sociality: gameState.sociality
    };
}

function restartGame() {
    // Сбрасываем состояние игры
    gameState.chapter = 0;
    gameState.clarity = 50;
    gameState.memory = 50;
    gameState.health = 50;
    gameState.philosophy = 50;
    gameState.sociality = 50;
    gameState.achievements = [];
    gameState.playTime = 0;
    gameState.choices = [];
    gameState.ending = null;
    gameState.path = {
        scholar: 0,
        mystic: 0,
        realist: 0,
        extreme: 0,
        balanced: 0
    };
    gameState.stats = {
        totalChoices: 0,
        extremeChoices: 0,
        balancedChoices: 0,
        comboChoices: 0,
        lastChoiceType: null
    };
    gameState.specialEvents = [];
    gameState.secrets = [];
    gameState.hints = 3;
    
    // Сброс достижений
    Object.keys(achievements).forEach(key => {
        achievements[key].unlocked = false;
    });
    
    // Удаляем классы концовок
    document.body.classList.remove('ending-good', 'ending-bad', 'ending-true', 
                                   'ending-neutral', 'ending-philosopher', 'ending-gameOver');
    
    // Восстанавливаем структуру DOM
    const textContainer = document.getElementById('text-container');
    const choicesContainer = document.getElementById('choices-container');
    
    // Проверяем, что элементы существуют в DOM
    let chapterTitle = document.getElementById('chapter-title');
    let storyText = document.getElementById('story-text');
    
    // Если элементы были удалены (при показе концовки), воссоздаём их
    if (!chapterTitle || !storyText) {
        textContainer.innerHTML = `
            <div id="chapter-title"></div>
            <div id="story-text"></div>
        `;
    }
    
    // Очищаем контейнеры выборов
    if (choicesContainer) {
        choicesContainer.innerHTML = '';
    }
    
    // Удаляем сохранение
    localStorage.removeItem('schizophreniaGameSave');
    
    // Обновляем экран
    updateGameScreen();
    
    showNotification('Новая игра начата');
}

// Вспомогательная функция для перемешивания массива
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Выбор игрока
function makeChoice(choice) {
    gameState.choices.push({
        chapter: gameState.chapter,
        choice: choice.text,
        timestamp: Date.now()
    });
    
    // Система комбо - если выборы одного типа подряд
    const choiceType = choice.extreme ? 'extreme' : (choice.secret ? 'secret' : 'normal');
    if (gameState.stats.lastChoiceType === choiceType) {
        gameState.stats.comboChoices++;
        if (gameState.stats.comboChoices >= 3 && !achievements.combo.unlocked) {
            unlockAchievement("combo");
            showNotification("Комбо! +5 ко всем параметрам");
            gameState.clarity = Math.min(100, gameState.clarity + 5);
            gameState.memory = Math.min(100, gameState.memory + 5);
            gameState.health = Math.min(100, gameState.health + 5);
            gameState.philosophy = Math.min(100, gameState.philosophy + 5);
            gameState.sociality = Math.min(100, gameState.sociality + 5);
        }
    } else {
        gameState.stats.comboChoices = 0;
    }
    gameState.stats.lastChoiceType = choiceType;
    
    // Сохраняем старые значения для проверки достижений
    const oldHealth = gameState.health;
    
    // Обновляем статистику
    gameState.clarity = Math.max(0, Math.min(100, gameState.clarity + (choice.clarity || 0)));
    gameState.memory = Math.max(0, Math.min(100, gameState.memory + (choice.memory || 0)));
    gameState.health = Math.max(0, Math.min(100, gameState.health + (choice.health || 0)));
    gameState.philosophy = Math.max(0, Math.min(100, gameState.philosophy + (choice.philosophy || 0)));
    gameState.sociality = Math.max(0, Math.min(100, gameState.sociality + (choice.sociality || 0)));
    
    // Проверка на возвращение (comeback achievement)
    if (oldHealth < 20 && gameState.health > 60 && !achievements.comeback.unlocked) {
        unlockAchievement("comeback");
    }
    
    gameState.stats.totalChoices++;
    if (choice.extreme) {
        gameState.stats.extremeChoices++;
        gameState.path.extreme++;
    }
    
    // Если нашли секрет
    if (choice.secret) {
        if (!gameState.secrets.includes(gameState.chapter)) {
            gameState.secrets.push(gameState.chapter);
            showNotification("🔍 Секрет найден!");
        }
    }
    
    // Отслеживаем путь
    if (choice.achievement === "scholar") {
        gameState.path.scholar++;
    } else if (choice.achievement === "mystic") {
        gameState.path.mystic++;
    } else if (choice.achievement === "realist") {
        gameState.path.realist++;
    }
    
    // Проверяем сбалансированный путь
    const changes = Math.abs(choice.clarity || 0) + Math.abs(choice.memory || 0) + 
                    Math.abs(choice.health || 0) + Math.abs(choice.philosophy || 0) + 
                    Math.abs(choice.sociality || 0);
    if (changes < 30 && !choice.extreme) {
        gameState.path.balanced++;
    }
    
    // Разблокируем достижение если есть
    if (choice.achievement && !achievements[choice.achievement].unlocked) {
        unlockAchievement(choice.achievement);
    }
    
    // Проверка на идеальное состояние
    const allStats = [gameState.clarity, gameState.memory, gameState.health, 
                      gameState.philosophy, gameState.sociality];
    const allInRange = allStats.every(s => s >= 45 && s <= 55);
    if (allInRange && !achievements.perfect.unlocked) {
        unlockAchievement("perfect");
        showNotification("✨ Идеальное равновесие!");
    }
    
    // Проверяем условия проигрыша после изменения параметров
    const gameOver = checkGameOver();
    if (gameOver) {
        gameState.ending = "gameOver";
        showEnding(endings.gameOver);
        saveGame();
        return;
    }
    
    // Если это специальная глава для определения концовки
    if (choice.checkEnding) {
        const ending = determineEnding();
        gameState.ending = ending.id;
        showEnding(ending);
        saveGame();
        return;
    }
    
    // Переходим к следующей главе
    if (choice.next === -1 || choice.next >= chapters.length) {
        // Если достигли конца, определяем концовку
        const ending = determineEnding();
        gameState.ending = ending.id;
        showEnding(ending);
        saveGame();
        return;
    }
    
    if (choice.next >= 0 && choice.next < chapters.length) {
        gameState.chapter = choice.next;
    } else {
        // Если индекс некорректный, определяем концовку
        const ending = determineEnding();
        gameState.ending = ending.id;
        showEnding(ending);
        saveGame();
        return;
    }
    
    // Автосохранение
    saveGame();
    
    updateGameScreen();
}

// Обновление статистики
function updateStats() {
    document.getElementById('clarity-value').textContent = gameState.clarity;
    document.getElementById('memory-value').textContent = gameState.memory;
    document.getElementById('health-value').textContent = gameState.health;
    document.getElementById('philosophy-value').textContent = gameState.philosophy;
    document.getElementById('sociality-value').textContent = gameState.sociality;
    
    document.getElementById('clarity-bar').style.width = gameState.clarity + '%';
    document.getElementById('memory-bar').style.width = gameState.memory + '%';
    document.getElementById('health-bar').style.width = gameState.health + '%';
    document.getElementById('philosophy-bar').style.width = gameState.philosophy + '%';
    document.getElementById('sociality-bar').style.width = gameState.sociality + '%';
    
    // Обновляем цвета баров в зависимости от значений
    updateBarColors();
    
    // Обновляем достижения
    updateAchievementsDisplay();
}

function updateBarColors() {
    const bars = ['clarity', 'memory', 'health', 'philosophy', 'sociality'];
    bars.forEach(stat => {
        const bar = document.getElementById(`${stat}-bar`);
        const value = gameState[stat];
        if (value < 30) {
            bar.style.background = 'linear-gradient(90deg, #ef5350, #e53935)';
        } else if (value < 50) {
            bar.style.background = 'linear-gradient(90deg, #ffb74d, #ffa726)';
        } else if (value < 70) {
            bar.style.background = 'linear-gradient(90deg, #64b5f6, #42a5f5)';
        } else {
            bar.style.background = 'linear-gradient(90deg, #66bb6a, #4caf50)';
        }
    });
}

function updateAchievementsDisplay() {
    const achievementsContainer = document.getElementById('achievements-list');
    if (!achievementsContainer) return;
    
    achievementsContainer.innerHTML = '';
    gameState.achievements.forEach(key => {
        const ach = achievements[key];
        const div = document.createElement('div');
        div.className = 'achievement-item unlocked';
        div.innerHTML = `
            <span class="achievement-icon">✓</span>
            <div>
                <div class="achievement-name">${ach.name}</div>
                <div class="achievement-desc">${ach.desc}</div>
            </div>
        `;
        achievementsContainer.appendChild(div);
    });
    
    // Показываем заблокированные достижения серым
    Object.keys(achievements).forEach(key => {
        if (!achievements[key].unlocked) {
            const ach = achievements[key];
            const div = document.createElement('div');
            div.className = 'achievement-item locked';
            div.innerHTML = `
                <span class="achievement-icon">?</span>
                <div>
                    <div class="achievement-name">${ach.name}</div>
                    <div class="achievement-desc">${ach.desc}</div>
                </div>
            `;
            achievementsContainer.appendChild(div);
        }
    });
}

// Запуск игры
window.onload = initGame;

// Глобальные функции для кнопок
window.restartGame = restartGame;
window.saveGame = saveGame;
window.loadGame = loadGame;

function toggleMenu() {
    const menuPanel = document.getElementById('menu-panel');
    menuPanel.classList.toggle('hidden');
    
    // Обновляем статистику в меню
    document.getElementById('chapters-completed').textContent = gameState.chapter;
    document.getElementById('choices-made').textContent = gameState.stats.totalChoices;
    updateAchievementsDisplay();
}
window.toggleMenu = toggleMenu;

